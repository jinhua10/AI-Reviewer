# 图片文字识别 - 快速启用指南

## 问题说明

如果您上传的PPTX/DOCX/XLSX文档中**只包含图片，没有文字**，系统默认无法提取图片中的内容。

例如：
- 上传"节约用水"PPT，图片中有大量说明文字
- 但系统回答"文档内容仅包含PPT模板的页面图片，没有任何文字内容"

## 解决方案：启用OCR

### 第1步：下载语言包（只需一次）

在release目录下，双击运行：

```
download-tessdata.bat
```

程序会自动下载：
- ✅ 中文简体语言包（chi_sim.traineddata，约12MB）
- ✅ 英文语言包（eng.traineddata，约4MB）

下载完成后会在release目录生成 `tessdata` 文件夹。

### 第2步：启动应用

**好消息！** 从最新版本开始，OCR功能已默认启用。

如果tessdata目录存在，系统会自动使用OCR识别图片中的文字。

如需禁用OCR，编辑 `start.bat`，在这三行前面添加 `:: ` 注释：

```batch
:: set ENABLE_OCR=true
:: set TESSDATA_PREFIX=%~dp0tessdata
:: set OCR_LANGUAGE=chi_sim+eng
```

### 第3步：启动/重启应用

1. 如果应用正在运行，先停止（按Ctrl+C 或运行 stop.bat）
2. 双击 `start.bat` 重新启动
3. 查看启动日志，应该看到：

```
✅ Tesseract OCR 可用 (语言: chi_sim+eng)
✅ 选择图片处理策略: Tesseract OCR
```

### 第4步：重新处理文档

1. 打开 http://localhost:8080
2. 进入"统计信息"标签页
3. 点击"重建索引"按钮
4. 等待处理完成（会看到进度）

### 第5步：测试效果

回到"智能问答"页面，重新提问：

```
为什么要节约用水？
```

这次系统会从图片中提取的文字进行回答！

**检查OCR是否生效：**

查看启动日志或 `logs/ai-reviewer-rag.log`，应该看到：

```
📊 TikaDocumentParser 初始化完成:
  ├─ 最大内容长度: 10MB
  ├─ 提取图片元数据: true
  ├─ 图片占位符: true
  └─ 图片处理策略: Tesseract OCR

🔍 OCR配置:
  ├─ ENABLE_OCR: true
  ├─ TESSDATA_PREFIX: D:\...\release\tessdata
  └─ OCR_LANGUAGE: chi_sim+eng

📷 提取图片: slide1_image1.png (245KB)
✅ 图片内容提取成功: slide1_image1.png -> 156 字符
```

## 工作原理

启用OCR后，系统会：

1. **自动识别**：检测文档中的所有图片
2. **文字提取**：使用Tesseract OCR识别图片中的文字
3. **加入索引**：将提取的文字加入知识库
4. **智能问答**：回答问题时使用图片中的内容

## 查看处理日志

在 `logs/ai-reviewer-rag.log` 中可以看到详细的处理信息：

```
提取图片: slide1_image1.png (245KB)
✅ OCR提取文字 [slide1_image1.png]: 156 字符
```

## 故障排除

### 问题1：OCR不可用

**现象**：日志显示 `⚠️ Tesseract OCR 不可用`

**解决**：
1. 确认 `ENABLE_OCR=true` （没有 :: 注释）
2. 确认 tessdata 目录存在且包含语言包文件
3. 重启应用

### 问题2：识别效果不好

**原因**：图片质量差、分辨率低、文字太小

**建议**：
- 使用高清晰的图片（分辨率 > 300dpi）
- 文字大小适中、对比度高
- 背景简单

### 问题3：处理速度慢

**说明**：OCR处理需要时间，特别是大图片

**优化**：
- 先批量上传所有文档
- 在空闲时间统一"重建索引"
- 避免频繁重建

## 高级功能

如果有OpenAI API密钥，可以使用更强大的AI视觉识别：

在 `start.bat` 中添加：

```batch
set VISION_LLM_API_KEY=sk-your-api-key
set VISION_LLM_MODEL=gpt-4o
```

系统会优先使用AI视觉识别，识别效果更好（支持手写、复杂图表等）。

## 完整文档

详细配置说明请参考：`OCR配置指南.md`

## 帮助

如有问题，请查看日志文件：`logs/ai-reviewer-rag.log`

---

**提示**：第一次下载语言包需要网络连接，如果下载失败，可以手动从以下地址下载：

- 中文简体：https://github.com/tesseract-ocr/tessdata/raw/main/chi_sim.traineddata
- 英文：https://github.com/tesseract-ocr/tessdata/raw/main/eng.traineddata

下载后放到 `tessdata` 目录即可。

