# å‘é‡æ£€ç´¢å¼•æ“ - æ¨¡å‹åŠ è½½ä¼˜åŒ–æ–¹æ¡ˆ

## ğŸ“‹ ä¿®æ”¹å†…å®¹

### 1. ä¿®æ”¹çš„ç±»
- `OptimizedExcelKnowledgeBuilder.java`

### 2. æ–°å¢åŠŸèƒ½
å®ç°äº†ä» `resources` ç›®å½•æˆ–æ–‡ä»¶ç³»ç»Ÿè‡ªåŠ¨åŠ è½½æ¨¡å‹æ–‡ä»¶çš„åŠŸèƒ½ã€‚

### 3. åŠ è½½ä¼˜å…ˆçº§

æ¨¡å‹æ–‡ä»¶ä¼šæŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§æŸ¥æ‰¾ï¼š

1. **resources ç›®å½•**ï¼ˆæ¨èï¼Œæ”¯æŒæ‰“åŒ…ï¼‰
   ```
   src/main/resources/models/text2vec-base-chinese/model.onnx
   ```
   - âœ… æ”¯æŒå¼€å‘ç¯å¢ƒ
   - âœ… æ”¯æŒ JAR åŒ…æ‰“åŒ…ï¼ˆè‡ªåŠ¨æå–åˆ°ä¸´æ—¶ç›®å½•ï¼‰
   - âœ… ä¸éœ€è¦é¢å¤–é…ç½®

2. **é¡¹ç›®æ ¹ç›®å½•**ï¼ˆå¼€å‘ç¯å¢ƒå¤‡ç”¨ï¼‰
   ```
   ./models/text2vec-base-chinese/model.onnx
   ```
   - âœ… é€‚åˆå¼€å‘ç¯å¢ƒ
   - âŒ ä¸é€‚åˆæ‰“åŒ…å‘å¸ƒ

3. **ç»å¯¹è·¯å¾„**ï¼ˆç”¨æˆ·è‡ªå®šä¹‰ï¼‰
   ```
   models/text2vec-base-chinese/model.onnx
   ```
   - âœ… çµæ´»é…ç½®
   - âš ï¸ éœ€è¦æ‰‹åŠ¨ç®¡ç†è·¯å¾„

---

## ğŸ”§ æ ¸å¿ƒå®ç°

### æ–°å¢æ–¹æ³•ï¼š`getModelPathFromResourcesOrFileSystem()`

```java
private String getModelPathFromResourcesOrFileSystem() throws IOException {
    // æ–¹å¼1ï¼šä» classpath/resources åŠ è½½
    String resourcePath = "/models/text2vec-base-chinese/model.onnx";
    java.net.URL resourceUrl = getClass().getResource(resourcePath);
    
    if (resourceUrl != null) {
        // å¦‚æœæ˜¯ jar åŒ…å†…èµ„æºï¼Œæå–åˆ°ä¸´æ—¶æ–‡ä»¶
        if (resourceUrl.getProtocol().equals("jar")) {
            // æå–é€»è¾‘...
        } else {
            // ç›´æ¥ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„
        }
    }
    
    // æ–¹å¼2ï¼šä»æ–‡ä»¶ç³»ç»ŸåŠ è½½
    // æ–¹å¼3ï¼šä»ç»å¯¹è·¯å¾„åŠ è½½
    
    // æ‰€æœ‰æ–¹å¼éƒ½å¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸
}
```

### å…³é”®ç‰¹æ€§

1. **JAR åŒ…æ”¯æŒ**ï¼šæ£€æµ‹åˆ° JAR åŒ…å†…èµ„æºæ—¶ï¼Œè‡ªåŠ¨æå–åˆ°ä¸´æ—¶æ–‡ä»¶
2. **é”™è¯¯æç¤º**ï¼šè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼ŒæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æ”¾ç½®æ¨¡å‹æ–‡ä»¶
3. **æ—¥å¿—è®°å½•**ï¼šæ¸…æ™°çš„æ—¥å¿—è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•

---

## ğŸ“¦ ä½¿ç”¨æ–¹å¼

### æ–¹å¼1ï¼šå°†æ¨¡å‹æ”¾åˆ° resourcesï¼ˆæ¨èï¼‰

```
é¡¹ç›®ç»“æ„ï¼š
ai-reviewer-base-file-rag/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ main/
â”‚       â””â”€â”€ resources/
â”‚           â””â”€â”€ models/
â”‚               â””â”€â”€ text2vec-base-chinese/
â”‚                   â”œâ”€â”€ model.onnx
â”‚                   â”œâ”€â”€ tokenizer.json
â”‚                   â””â”€â”€ config.json
```

**ä¼˜ç‚¹**ï¼š
- âœ… æ”¯æŒå¼€å‘ç¯å¢ƒç›´æ¥è¿è¡Œ
- âœ… æ”¯æŒæ‰“åŒ…æˆ JAR åè¿è¡Œ
- âœ… ä¸éœ€è¦é¢å¤–é…ç½®

**Maven é…ç½®**ï¼š

åœ¨ `pom.xml` ä¸­æ·»åŠ ï¼š

```xml
<build>
    <resources>
        <resource>
            <directory>src/main/resources</directory>
            <includes>
                <include>**/*</include>
            </includes>
        </resource>
    </resources>
</build>
```

### æ–¹å¼2ï¼šæ”¾åˆ°é¡¹ç›®æ ¹ç›®å½•

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ models/
â”‚   â””â”€â”€ text2vec-base-chinese/
â”‚       â”œâ”€â”€ model.onnx
â”‚       â”œâ”€â”€ tokenizer.json
â”‚       â””â”€â”€ config.json
```

**ä¼˜ç‚¹**ï¼š
- âœ… é€‚åˆå¼€å‘ç¯å¢ƒ
- âœ… æ¨¡å‹æ–‡ä»¶è¾ƒå¤§æ—¶ä¸å½±å“ç¼–è¯‘é€Ÿåº¦

**ç¼ºç‚¹**ï¼š
- âŒ æ‰“åŒ…æ—¶ä¸ä¼šåŒ…å«æ¨¡å‹æ–‡ä»¶
- âŒ éœ€è¦æ‰‹åŠ¨éƒ¨ç½²æ¨¡å‹æ–‡ä»¶

---

## âœ… æµ‹è¯•éªŒè¯

### æµ‹è¯•ç±»ï¼š`VectorSearchTest.java`

```java
OptimizedExcelKnowledgeBuilder builder = new OptimizedExcelKnowledgeBuilder(
    "./data/test-knowledge-base",
    "./data/excel-files",
    false, // è‡ªåŠ¨åˆ†å—
    true   // å¯ç”¨å‘é‡æ£€ç´¢
);
```

### æµ‹è¯•ç»“æœ

```
âœ… ä» resources åŠ è½½æ¨¡å‹: .../target/classes/models/text2vec-base-chinese/model.onnx
âœ… å‘é‡æ£€ç´¢å¼•æ“åˆå§‹åŒ–æˆåŠŸï¼ˆé€‚åˆ<10ä¸‡æ¡æ–‡æ¡£ï¼‰
Vector Search: âœ… Enabled
Embedding Model: text2vec-base-chinese
Vector Dimension: 384
```

---

## ğŸ¯ è¿è¡Œæ£€æŸ¥

### æ£€æŸ¥å‘é‡æ£€ç´¢æ˜¯å¦å¯ç”¨

è¿è¡Œç¨‹åºæ—¶ï¼ŒæŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼š

```log
ğŸš€ åˆå§‹åŒ–å‘é‡æ£€ç´¢å¼•æ“ï¼ˆç®€åŒ–ç‰ˆï¼‰...
âœ… ä» resources åŠ è½½æ¨¡å‹: <æ¨¡å‹è·¯å¾„>
ğŸ“¦ æ¨¡å‹è·¯å¾„: <æ¨¡å‹è·¯å¾„>
âœ… å‘é‡æ£€ç´¢å¼•æ“åˆå§‹åŒ–æˆåŠŸï¼ˆé€‚åˆ<10ä¸‡æ¡æ–‡æ¡£ï¼‰
```

å¦‚æœçœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼Œè¯´æ˜å‘é‡æ£€ç´¢å·²å¯ç”¨ï¼š

```log
Vector Search: âœ… Enabled
Embedding Model: text2vec-base-chinese
Vector Dimension: 384
```

å¦‚æœçœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼Œè¯´æ˜å‘é‡æ£€ç´¢æœªå¯ç”¨ï¼ˆå°†ä½¿ç”¨çº¯å…³é”®è¯æ£€ç´¢ï¼‰ï¼š

```log
âŒ å‘é‡æ£€ç´¢å¼•æ“åˆå§‹åŒ–å¤±è´¥ï¼Œå°†ä½¿ç”¨çº¯å…³é”®è¯æ£€ç´¢æ¨¡å¼
ğŸ’¡ æç¤ºï¼šå¦‚éœ€å¯ç”¨å‘é‡æ£€ç´¢ï¼Œè¯·ç¡®ä¿æ¨¡å‹æ–‡ä»¶å·²ä¸‹è½½
   æ–¹å¼1: æ”¾åˆ° resources/models/text2vec-base-chinese/model.onnx
   æ–¹å¼2: æ”¾åˆ° ./models/text2vec-base-chinese/model.onnx
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. æ¨¡å‹æ–‡ä»¶å¤§å°

`model.onnx` æ–‡ä»¶é€šå¸¸è¾ƒå¤§ï¼ˆå‡ ç™¾MBï¼‰ï¼Œå»ºè®®ï¼š

- å¼€å‘ç¯å¢ƒï¼šæ”¾åˆ° `resources`ï¼Œæ–¹ä¾¿ä½¿ç”¨
- ç”Ÿäº§ç¯å¢ƒï¼šå¦‚æœæ‰“åŒ…æ–‡ä»¶è¿‡å¤§ï¼Œè€ƒè™‘å¤–éƒ¨éƒ¨ç½²æ¨¡å‹æ–‡ä»¶

### 2. Maven æ‰“åŒ…é…ç½®

å¦‚æœæ¨¡å‹æ–‡ä»¶å¾ˆå¤§ï¼Œå¯èƒ½éœ€è¦å¢åŠ  Maven çš„å†…å­˜ï¼š

```bash
export MAVEN_OPTS="-Xmx2g"
mvn clean package
```

### 3. ä¸´æ—¶æ–‡ä»¶æ¸…ç†

ä» JAR åŒ…æå–çš„æ¨¡å‹æ–‡ä»¶ä¼šåœ¨ JVM é€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤ï¼ˆ`deleteOnExit()`ï¼‰ã€‚

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `OptimizedExcelKnowledgeBuilder.java` - ä¸»è¦å®ç°ç±»
- `LocalEmbeddingEngine.java` - æœ¬åœ°åµŒå…¥å¼•æ“
- `SimpleVectorIndexEngine.java` - å‘é‡ç´¢å¼•å¼•æ“
- `VectorSearchTest.java` - æµ‹è¯•ç±»

---

## ğŸ“Š æ€§èƒ½è¯´æ˜

- **å‘é‡ç»´åº¦**ï¼š384
- **é€‚ç”¨åœºæ™¯**ï¼š< 10ä¸‡æ¡æ–‡æ¡£
- **æ£€ç´¢æ–¹å¼**ï¼šçº¿æ€§æ‰«æï¼ˆSimple Vector Indexï¼‰
- **å­˜å‚¨æ–¹å¼**ï¼šæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ

---

## ğŸ‰ æ€»ç»“

âœ… **å®ç°äº†æ–¹æ¡ˆ1**ï¼šä» resources æˆ–æ–‡ä»¶ç³»ç»ŸåŠ è½½æ¨¡å‹æ–‡ä»¶

âœ… **æ”¯æŒæ‰“åŒ…åè¿è¡Œ**ï¼šè‡ªåŠ¨æå– JAR åŒ…å†…çš„æ¨¡å‹åˆ°ä¸´æ—¶ç›®å½•

âœ… **è¯¦ç»†çš„é”™è¯¯æç¤º**ï¼šå‘ŠçŸ¥ç”¨æˆ·å¦‚ä½•æ”¾ç½®æ¨¡å‹æ–‡ä»¶

âœ… **æµ‹è¯•éªŒè¯é€šè¿‡**ï¼šå‘é‡æ£€ç´¢å¼•æ“åˆå§‹åŒ–æ­£å¸¸

ç°åœ¨ä½ å¯ä»¥ï¼š
1. å°†æ¨¡å‹æ–‡ä»¶æ”¾åˆ° `src/main/resources/models/text2vec-base-chinese/model.onnx`
2. è¿è¡Œ `ExcelKnowledgeQASystem`ï¼Œå‘é‡æ£€ç´¢å°†è‡ªåŠ¨å¯ç”¨
3. æ‰“åŒ…æˆ JAR åä¾ç„¶å¯ä»¥æ­£å¸¸è¿è¡Œ

