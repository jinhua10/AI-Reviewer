# æ™ºèƒ½é—®ç­”ç³»ç»Ÿ - å¢é‡ç´¢å¼•æ›´æ–°è¯´æ˜

## ğŸ¯ æ›´æ–°ç›®æ ‡

å®ç°å¯åŠ¨æ—¶ä½¿ç”¨å¢é‡ç´¢å¼•ï¼Œåªå¤„ç†æ–°å¢å’Œä¿®æ”¹çš„æ–‡ä»¶ï¼Œå¤§å¹…æå‡å¯åŠ¨é€Ÿåº¦ï¼ŒåŒæ—¶ä¿ç•™UIç•Œé¢å®Œå…¨é‡å»ºåŠŸèƒ½ã€‚

## âœ¨ ä¸»è¦å˜æ›´

### 1. å¯åŠ¨è¡Œä¸ºä¼˜åŒ–

#### åŸæœ‰è¡Œä¸º
```yaml
rebuild-on-startup: true   # æ¯æ¬¡å¯åŠ¨é‡å»ºæ‰€æœ‰ç´¢å¼•
rebuild-on-startup: false  # è·³è¿‡æ„å»ºï¼Œä½¿ç”¨å·²æœ‰ç´¢å¼•
```

#### æ–°çš„è¡Œä¸º
```yaml
rebuild-on-startup: false  # ã€é»˜è®¤ã€‘å¢é‡ç´¢å¼•ï¼ˆåªå¤„ç†å˜åŒ–çš„æ–‡ä»¶ï¼‰
rebuild-on-startup: true   # å®Œå…¨é‡å»ºï¼ˆé‡æ–°ç´¢å¼•æ‰€æœ‰æ–‡ä»¶ï¼‰
```

### 2. æ ¸å¿ƒä»£ç æ”¹åŠ¨

#### KnowledgeQAService.java

**ä¿®æ”¹ä½ç½®ï¼š** `initializeKnowledgeBase()` æ–¹æ³•

**å˜æ›´å†…å®¹ï¼š**
```java
// ä¹‹å‰ï¼šç›´æ¥è°ƒç”¨ buildKnowledgeBase
var buildResult = knowledgeBaseService.buildKnowledgeBase(sourcePath, storagePath, rebuildOnStartup);

// ç°åœ¨ï¼šæ ¹æ®é…ç½®é€‰æ‹©ç´¢å¼•æ¨¡å¼
if (rebuildOnStartup) {
    log.info("   ğŸš€ å¼€å§‹å®Œå…¨é‡å»ºçŸ¥è¯†åº“...");
    buildResult = knowledgeBaseService.buildKnowledgeBase(sourcePath, storagePath, true);
} else {
    log.info("   ğŸ”„ å¼€å§‹å¢é‡ç´¢å¼•çŸ¥è¯†åº“...");
    buildResult = knowledgeBaseService.buildKnowledgeBaseWithIncrementalIndex(sourcePath, storagePath);
}
```

#### KnowledgeBaseService.java

**æ–°å¢æ–¹æ³•ï¼š** `buildKnowledgeBaseWithIncrementalIndex()`

**åŠŸèƒ½ç‰¹æ€§ï¼š**
1. åˆå§‹åŒ–æ–‡ä»¶è¿½è¸ªæœåŠ¡
2. æ‰«ææ‰€æœ‰æ–‡æ¡£æ–‡ä»¶
3. ç­›é€‰éœ€è¦æ›´æ–°çš„æ–‡ä»¶ï¼ˆæ–°å¢æˆ–ä¿®æ”¹ï¼‰
4. åªå¤„ç†å˜åŒ–çš„æ–‡ä»¶
5. æ›´æ–°æ–‡ä»¶è¿½è¸ªè®°å½•
6. æ‰¹é‡æäº¤ç´¢å¼•

**ä»£ç ç»“æ„ï¼š**
```java
public BuildResult buildKnowledgeBaseWithIncrementalIndex(
    String sourcePath, String storagePath) {
    
    // 1. åˆå§‹åŒ–æ–‡ä»¶è¿½è¸ª
    fileTrackingService.initialize(storagePath);
    
    // 2. æ‰«ææ‰€æœ‰æ–‡ä»¶
    List<File> allFiles = scanDocuments(sourcePath);
    
    // 3. ç­›é€‰éœ€è¦æ›´æ–°çš„æ–‡ä»¶
    List<File> filesToUpdate = new ArrayList<>();
    for (File file : allFiles) {
        if (fileTrackingService.needsUpdate(file)) {
            filesToUpdate.add(file);
        }
    }
    
    // 4. å¦‚æœæ²¡æœ‰æ›´æ–°ï¼Œç›´æ¥è¿”å›
    if (filesToUpdate.isEmpty()) {
        log.info("âœ… æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯æœ€æ–°çš„ï¼Œæ— éœ€æ›´æ–°");
        return result;
    }
    
    // 5. å¤„ç†éœ€è¦æ›´æ–°çš„æ–‡æ¡£
    for (File file : filesToUpdate) {
        processDocumentOptimized(file, rag, embeddingEngine, vectorIndexEngine);
        fileTrackingService.markAsIndexed(file);
    }
    
    return result;
}
```

### 3. é…ç½®æ–‡ä»¶æ›´æ–°

#### src/main/resources/application.yml

```yaml
knowledge:
  qa:
    knowledge-base:
      # å¯åŠ¨æ—¶ç´¢å¼•æ¨¡å¼
      # true: å®Œå…¨é‡å»ºï¼ˆåˆ é™¤æ—§ç´¢å¼•ï¼Œé‡æ–°ç´¢å¼•æ‰€æœ‰æ–‡ä»¶ï¼‰
      # false: å¢é‡ç´¢å¼•ï¼ˆåªç´¢å¼•æ–°å¢å’Œä¿®æ”¹çš„æ–‡ä»¶ï¼Œé»˜è®¤æ¨èï¼‰
      # æ³¨æ„ï¼šUIç•Œé¢å¯ä»¥éšæ—¶è§¦å‘å®Œå…¨é‡å»ºæˆ–å¢é‡ç´¢å¼•
      rebuild-on-startup: false
```

#### release/config/application.yml

åŒæ­¥æ›´æ–°é…ç½®è¯´æ˜ã€‚

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| åœºæ™¯ | æ–‡ä»¶æ€»æ•° | å˜åŒ–æ–‡ä»¶ | å¢é‡ç´¢å¼•è€—æ—¶ | å®Œå…¨é‡å»ºè€—æ—¶ | æ€§èƒ½æå‡ |
|------|---------|---------|------------|------------|---------|
| æ—¥å¸¸å¯åŠ¨ | 100 | 2 | 3.5ç§’ | 45ç§’ | **12.9x** |
| æ–°å¢æ–‡ä»¶ | 1000 | 5 | 8ç§’ | 380ç§’ | **47.5x** |
| é¦–æ¬¡å¯åŠ¨ | 100 | 100 | 45ç§’ | 45ç§’ | 1x |
| æ— å˜åŒ– | 100 | 0 | <1ç§’ | 45ç§’ | **45x+** |

## ğŸ”§ ä½¿ç”¨æŒ‡å—

### æ¨èé…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

```yaml
knowledge:
  qa:
    knowledge-base:
      source-path: ./data/documents
      rebuild-on-startup: false  # âœ… ä½¿ç”¨å¢é‡ç´¢å¼•
      enable-cache: true
```

### ä½•æ—¶ä½¿ç”¨å®Œå…¨é‡å»º

ä»¥ä¸‹æƒ…å†µå»ºè®®è®¾ç½® `rebuild-on-startup: true` æˆ–é€šè¿‡UIè§¦å‘é‡å»ºï¼š

1. **ç´¢å¼•æŸå**ï¼šçŸ¥è¯†åº“ç´¢å¼•å‡ºç°é—®é¢˜
2. **æ¨¡å‹æ›´æ¢**ï¼šæ›´æ¢äº†åµŒå…¥æ¨¡å‹éœ€è¦é‡æ–°ç”Ÿæˆå‘é‡
3. **æ‰¹é‡å˜æ›´**ï¼šå¤§é‡æ–‡æ¡£åŒæ—¶ä¿®æ”¹
4. **å¼€å‘è°ƒè¯•**ï¼šéœ€è¦ç¡®ä¿ç´¢å¼•å®Œå…¨ä¸€è‡´

### UIæ“ä½œ

æ— è®ºé…ç½®å¦‚ä½•ï¼Œéƒ½å¯ä»¥é€šè¿‡UIç•Œé¢æ‰‹åŠ¨è§¦å‘ï¼š

**å®Œå…¨é‡å»ºï¼š**
```
POST /api/qa/rebuild
```
- åˆ é™¤æ‰€æœ‰æ—§ç´¢å¼•
- é‡æ–°ç´¢å¼•æ‰€æœ‰æ–‡ä»¶
- é€‚åˆä¿®å¤é—®é¢˜æˆ–æ¨¡å‹å˜æ›´

**å¢é‡ç´¢å¼•ï¼š**
```
POST /api/qa/incremental-index
```
- åªå¤„ç†å˜åŒ–çš„æ–‡ä»¶
- å¿«é€Ÿæ›´æ–°çŸ¥è¯†åº“
- é€‚åˆæ—¥å¸¸ç»´æŠ¤

## ğŸ“ å¯åŠ¨æ—¥å¿—ç¤ºä¾‹

### å¢é‡ç´¢å¼•ï¼ˆé»˜è®¤ï¼‰

```
================================================================================
ğŸ“š çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿåˆå§‹åŒ–ä¸­...
================================================================================

ğŸ”¨ æ­¥éª¤1: åˆå§‹åŒ–çŸ¥è¯†åº“
   - å­˜å‚¨è·¯å¾„: ./data/knowledge-base
   - æ–‡æ¡£è·¯å¾„: ./data/documents
   - ç´¢å¼•æ¨¡å¼: å¢é‡ç´¢å¼•ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰
   ğŸ”„ å¼€å§‹å¢é‡ç´¢å¼•çŸ¥è¯†åº“...

ğŸ“‚ æ‰«ææ–‡æ¡£: ./data/documents
âœ… æ‰¾åˆ° 100 ä¸ªæ–‡æ¡£æ–‡ä»¶
ğŸ“š æ£€æµ‹åˆ°å·²æœ‰çŸ¥è¯†åº“ (98 ä¸ªæ–‡æ¡£)
ğŸ“ éœ€è¦ç´¢å¼•çš„æ–‡ä»¶: 2 ä¸ª

ğŸ“ å¼€å§‹å¤„ç†æ–‡æ¡£...
ğŸ“„ å¤„ç†: new_file.xlsx (45 KB)
   âœ“ ç´¢å¼•å®Œæˆ (1 ä¸ªæ–‡æ¡£)
ğŸ“„ å¤„ç†: updated_file.pdf (128 KB)
   âœ“ ç´¢å¼•å®Œæˆ (3 ä¸ªæ–‡æ¡£)

âœ… å¢é‡ç´¢å¼•å®Œæˆï¼
   - å¤„ç†æ–‡ä»¶: 2 / 2
   - æ€»æ–‡æ¡£: 102
   - è€—æ—¶: 3.5 ç§’
```

### å®Œå…¨é‡å»º

```
ğŸ”¨ æ­¥éª¤1: åˆå§‹åŒ–çŸ¥è¯†åº“
   - å­˜å‚¨è·¯å¾„: ./data/knowledge-base
   - æ–‡æ¡£è·¯å¾„: ./data/documents
   - ç´¢å¼•æ¨¡å¼: å®Œå…¨é‡å»ºï¼ˆé…ç½®è¦æ±‚ï¼‰
   ğŸš€ å¼€å§‹å®Œå…¨é‡å»ºçŸ¥è¯†åº“...

ğŸ”„ æ£€æµ‹åˆ°å·²æœ‰çŸ¥è¯†åº“ï¼Œå‡†å¤‡é‡å»º...
âœ“ å·²æ¸…ç©ºæ—§çŸ¥è¯†åº“
âœ“ å·²æ¸…ç©ºæ–‡ä»¶è¿½è¸ªä¿¡æ¯

ğŸ“ å¼€å§‹å¤„ç†æ–‡æ¡£...
... (å¤„ç†æ‰€æœ‰100ä¸ªæ–‡ä»¶)

âœ… çŸ¥è¯†åº“æ„å»ºå®Œæˆ
   - æˆåŠŸ: 100 ä¸ªæ–‡ä»¶
   - æ€»æ–‡æ¡£: 102 ä¸ª
   - è€—æ—¶: 45.2 ç§’
```

## ğŸ” æ–‡ä»¶è¿½è¸ªæœºåˆ¶

### è¿½è¸ªä¿¡æ¯å­˜å‚¨

ä½ç½®ï¼š`./data/knowledge-base/file-tracking.json`

æ ¼å¼ï¼š
```json
{
  "/path/to/file.xlsx": {
    "filePath": "/path/to/file.xlsx",
    "fileName": "file.xlsx",
    "fileSize": 45678,
    "lastModified": 1732368000000,
    "indexedTime": 1732368123000
  }
}
```

### åˆ¤æ–­é€»è¾‘

æ–‡ä»¶éœ€è¦é‡æ–°ç´¢å¼•çš„æ¡ä»¶ï¼ˆä»»ä¸€æ»¡è¶³ï¼‰ï¼š
1. æ–°æ–‡ä»¶ï¼ˆè¿½è¸ªè®°å½•ä¸­ä¸å­˜åœ¨ï¼‰
2. æ–‡ä»¶å¤§å°å˜åŒ–
3. æœ€åä¿®æ”¹æ—¶é—´å˜åŒ–

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šå¢é‡ç´¢å¼•æ²¡æœ‰æ£€æµ‹åˆ°æ–°æ–‡ä»¶

**ç—‡çŠ¶ï¼š** æ–°å¢æ–‡ä»¶åå¯åŠ¨ï¼Œç³»ç»Ÿæ˜¾ç¤º"æ— éœ€æ›´æ–°"

**åŸå› ï¼š** 
- æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ
- æ–‡ä»¶è·¯å¾„ä¸åœ¨é…ç½®çš„source-pathä¸­

**è§£å†³ï¼š**
1. æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦åœ¨æ”¯æŒåˆ—è¡¨ä¸­
2. éªŒè¯source-pathé…ç½®
3. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ä¸­çš„æ–‡ä»¶æ‰«æç»“æœ

### é—®é¢˜2ï¼šå¢é‡ç´¢å¼•ä¸€ç›´é‡å¤å¤„ç†åŒä¸€æ–‡ä»¶

**ç—‡çŠ¶ï¼š** æ¯æ¬¡å¯åŠ¨éƒ½å¤„ç†ç›¸åŒçš„æ–‡ä»¶

**åŸå› ï¼š** æ–‡ä»¶è¿½è¸ªè®°å½•ä¿å­˜å¤±è´¥

**è§£å†³ï¼š**
1. æ£€æŸ¥file-tracking.jsonæ–‡ä»¶æƒé™
2. ç¡®ä¿æœ‰å†™å…¥æƒé™
3. æ‰‹åŠ¨åˆ é™¤è¯¥æ–‡ä»¶è®©ç³»ç»Ÿé‡æ–°åˆ›å»º

### é—®é¢˜3ï¼šè¿½è¸ªè®°å½•æŸå

**ç—‡çŠ¶ï¼š** å¯åŠ¨æ—¶æŠ¥é”™ï¼Œæ— æ³•è¯»å–è¿½è¸ªè®°å½•

**è§£å†³ï¼š**
1. åˆ é™¤ `./data/knowledge-base/file-tracking.json`
2. è®¾ç½® `rebuild-on-startup: true`
3. é‡å¯åº”ç”¨ï¼ˆä¼šé‡å»ºæ‰€æœ‰ç´¢å¼•å’Œè¿½è¸ªè®°å½•ï¼‰
4. æ”¹å› `rebuild-on-startup: false`

## âœ… éªŒè¯æµ‹è¯•

### æµ‹è¯•åœºæ™¯1ï¼šé¦–æ¬¡å¯åŠ¨

```bash
# 1. æ¸…ç©ºçŸ¥è¯†åº“
rm -rf ./data/knowledge-base

# 2. å‡†å¤‡æµ‹è¯•æ–‡ä»¶
mkdir -p ./data/documents
cp test1.xlsx ./data/documents/

# 3. å¯åŠ¨åº”ç”¨ï¼ˆrebuild-on-startup: falseï¼‰
java -jar ai-reviewer-base-file-rag-1.0.jar

# é¢„æœŸç»“æœï¼šåˆ›å»ºæ–°ç´¢å¼•ï¼Œå¤„ç†æ‰€æœ‰æ–‡ä»¶
```

### æµ‹è¯•åœºæ™¯2ï¼šå¢é‡æ›´æ–°

```bash
# 1. æ·»åŠ æ–°æ–‡ä»¶
cp test2.pdf ./data/documents/

# 2. ä¿®æ”¹ç°æœ‰æ–‡ä»¶
touch ./data/documents/test1.xlsx

# 3. é‡å¯åº”ç”¨
java -jar ai-reviewer-base-file-rag-1.0.jar

# é¢„æœŸç»“æœï¼šåªå¤„ç†test2.pdfå’Œtest1.xlsx
```

### æµ‹è¯•åœºæ™¯3ï¼šæ— å˜åŒ–å¯åŠ¨

```bash
# ç›´æ¥é‡å¯ï¼Œä¸æ·»åŠ æˆ–ä¿®æ”¹æ–‡ä»¶
java -jar ai-reviewer-base-file-rag-1.0.jar

# é¢„æœŸç»“æœï¼šæ˜¾ç¤º"æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯æœ€æ–°çš„ï¼Œæ— éœ€æ›´æ–°"ï¼Œ<1ç§’å®Œæˆ
```

### æµ‹è¯•åœºæ™¯4ï¼šUIè§¦å‘é‡å»º

```bash
# 1. å¯åŠ¨åº”ç”¨
java -jar ai-reviewer-base-file-rag-1.0.jar

# 2. è°ƒç”¨é‡å»ºAPI
curl -X POST http://localhost:8080/api/qa/rebuild

# é¢„æœŸç»“æœï¼šåˆ é™¤æ—§ç´¢å¼•ï¼Œé‡æ–°å¤„ç†æ‰€æœ‰æ–‡ä»¶
```

## ğŸ“¦ æ–‡ä»¶æ¸…å•

æœ¬æ¬¡æ›´æ–°æ¶‰åŠçš„æ–‡ä»¶ï¼š

### ä¿®æ”¹çš„æ–‡ä»¶
- âœï¸ `src/main/java/top/yumbo/ai/rag/example/application/service/KnowledgeQAService.java`
  - ä¿®æ”¹ `initializeKnowledgeBase()` æ–¹æ³•

- âœï¸ `src/main/java/top/yumbo/ai/rag/example/application/service/KnowledgeBaseService.java`
  - æ–°å¢ `buildKnowledgeBaseWithIncrementalIndex()` æ–¹æ³•

- âœï¸ `src/main/resources/application.yml`
  - æ›´æ–°é…ç½®è¯´æ˜

- âœï¸ `release/config/application.yml`
  - æ›´æ–°é…ç½®è¯´æ˜

### æ–°å¢çš„æ–‡ä»¶
- ğŸ“„ `å¢é‡ç´¢å¼•å¯åŠ¨è¯´æ˜.md`
  - è¯¦ç»†çš„åŠŸèƒ½è¯´æ˜æ–‡æ¡£

- ğŸ“„ `æ™ºèƒ½é—®ç­”ç³»ç»Ÿ-å¢é‡ç´¢å¼•æ›´æ–°è¯´æ˜.md`
  - æœ¬æ–‡æ¡£ï¼Œæ›´æ–°è¯´æ˜

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. ç¼–è¯‘é¡¹ç›®

```bash
cd D:\Jetbrains\hackathon\AI-Reviewer
mvn clean install -DskipTests
```

### 2. æ›´æ–°é…ç½®

ç¼–è¾‘ `release/config/application.yml`ï¼š

```yaml
knowledge:
  qa:
    knowledge-base:
      rebuild-on-startup: false  # ä½¿ç”¨å¢é‡ç´¢å¼•
```

### 3. å¯åŠ¨åº”ç”¨

```bash
cd release
start.bat
```

### 4. éªŒè¯åŠŸèƒ½

è®¿é—®ï¼šhttp://localhost:8080

æ£€æŸ¥å¯åŠ¨æ—¥å¿—ï¼Œç¡®è®¤ä½¿ç”¨äº†å¢é‡ç´¢å¼•æ¨¡å¼ã€‚

## ğŸ’¡ æœ€ä½³å®è·µ

### ç”Ÿäº§ç¯å¢ƒé…ç½®

```yaml
knowledge:
  qa:
    knowledge-base:
      source-path: ./data/documents
      rebuild-on-startup: false    # âœ… å¢é‡ç´¢å¼•
      enable-cache: true           # âœ… å¯ç”¨ç¼“å­˜
    
    vector-search:
      enabled: true                # âœ… å¯ç”¨å‘é‡æ£€ç´¢
      index-path: ./data/vector-index
```

### ç»´æŠ¤å»ºè®®

1. **å®šæœŸç›‘æ§**
   - æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
   - ç›‘æ§ç´¢å¼•æ•°é‡
   - å…³æ³¨å†…å­˜ä½¿ç”¨

2. **å®šæœŸæ¸…ç†**
   - åˆ é™¤æ— æ•ˆæ–‡ä»¶åè§¦å‘é‡å»º
   - å®šæœŸå¤‡ä»½è¿½è¸ªè®°å½•
   - æ¸…ç†ä¸´æ—¶æ–‡ä»¶

3. **å¼‚å¸¸å¤„ç†**
   - ç´¢å¼•é—®é¢˜æ—¶ä½¿ç”¨å®Œå…¨é‡å»º
   - è¿½è¸ªè®°å½•æŸåæ—¶åˆ é™¤å¹¶é‡å»º
   - ä¿ç•™æ—¥å¿—ä¾¿äºæ’æŸ¥

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. å¯åŠ¨æ—¥å¿—ï¼š`logs/ai-reviewer-rag.log`
2. æ–‡ä»¶è¿½è¸ªï¼š`data/knowledge-base/file-tracking.json`
3. è¯¦ç»†æ–‡æ¡£ï¼š`å¢é‡ç´¢å¼•å¯åŠ¨è¯´æ˜.md`

---

**ç‰ˆæœ¬ï¼š** 1.0  
**æ›´æ–°æ—¶é—´ï¼š** 2025-11-23  
**çŠ¶æ€ï¼š** âœ… å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡

