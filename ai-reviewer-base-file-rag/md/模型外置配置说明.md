# æ¨¡å‹å¤–ç½®é…ç½®è¯´æ˜

## âœ… å®Œæˆçš„é…ç½®

### 1. æ‰“åŒ…æ—¶æ’é™¤æ¨¡å‹æ–‡ä»¶

**é…ç½®æ–‡ä»¶**: `pom.xml`

**Maven Antrun Plugin é…ç½®**:
```xml
<execution>
    <id>remove-resources-before-package</id>
    <phase>prepare-package</phase>
    <goals>
        <goal>run</goal>
    </goals>
    <configuration>
        <target>
            <!-- åˆ é™¤ simpleExcel -->
            <delete dir="${project.build.outputDirectory}/simpleExcel" quiet="true"/>
            
            <!-- åˆ é™¤ modelsï¼ˆä¸æ‰“åŒ…è¿›JARï¼‰ -->
            <delete dir="${project.build.outputDirectory}/models" quiet="true"/>
        </target>
    </configuration>
</execution>
```

**ç»“æœ**:
- âœ… JAR åŒ…ä¸­ä¸åŒ…å« `models` ç›®å½•
- âœ… JAR åŒ…å¤§å°å¤§å¹…å‡å°ï¼ˆå‡å°‘çº¦ 100-200MBï¼‰

---

### 2. å¤åˆ¶æ¨¡å‹åˆ° release ç›®å½•

**é…ç½®æ–‡ä»¶**: `pom.xml`

**Maven Antrun Plugin é…ç½®**:
```xml
<execution>
    <id>copy-models-to-release</id>
    <phase>package</phase>
    <goals>
        <goal>run</goal>
    </goals>
    <configuration>
        <target>
            <echo message="å¤åˆ¶æ¨¡å‹æ–‡ä»¶åˆ° release ç›®å½•"/>
            
            <!-- åˆ›å»º release/models ç›®å½• -->
            <mkdir dir="${project.basedir}/release/models"/>
            
            <!-- å¤åˆ¶ models ç›®å½•åˆ° release -->
            <copy todir="${project.basedir}/release/models" failonerror="false">
                <fileset dir="${project.basedir}/src/main/resources/models">
                    <include name="**/*.onnx"/>
                    <include name="**/*.txt"/>
                    <include name="**/*.json"/>
                </fileset>
            </copy>
        </target>
    </configuration>
</execution>
```

**æ³¨æ„**: å¦‚æœè‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼š
```powershell
# PowerShell å‘½ä»¤
Copy-Item -Path "src/main/resources/models" -Destination "release/models" -Recurse -Force
```

---

### 3. ä¿®æ”¹æ¨¡å‹åŠ è½½é€»è¾‘

**æ–‡ä»¶**: `LocalEmbeddingEngine.java`

**åŠ è½½ä¼˜å…ˆçº§**:
```
1. æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼ˆå¤–éƒ¨ models ç›®å½•ï¼‰ â† ä¼˜å…ˆ
2. Classpath è·¯å¾„ï¼ˆå¼€å‘ç¯å¢ƒå¤‡ç”¨ï¼‰
```

**ä»£ç é€»è¾‘**:
```java
// 1. ä¼˜å…ˆä»æ–‡ä»¶ç³»ç»ŸåŠ è½½
Path modelFile = Paths.get(modelPath);
if (Files.exists(modelFile)) {
    actualModelPath = modelFile.toAbsolutePath().toString();
    log.info("âœ… ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½æ¨¡å‹: {}", actualModelPath);
}

// 2. å°è¯•ä» classpath åŠ è½½ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰
if (actualModelPath == null) {
    var resource = getClass().getClassLoader().getResource(modelPath);
    if (resource != null) {
        Path path = Paths.get(resource.toURI());
        actualModelPath = path.toAbsolutePath().toString();
        log.info("âœ… ä» classpath åŠ è½½æ¨¡å‹: {}", actualModelPath);
    }
}
```

**ç§»é™¤çš„åŠŸèƒ½**:
- âŒ ä¸å†æ”¯æŒä» JAR å†…æå–æ¨¡å‹åˆ°ä¸´æ—¶æ–‡ä»¶
- âŒ ç§»é™¤äº† `extractModelFromJar()` æ–¹æ³•

---

### 4. æ›´æ–°é…ç½®æ–‡ä»¶

**æ–‡ä»¶**: `release/config/application.yml`

**é…ç½®ç¤ºä¾‹**:
```yaml
knowledge:
  qa:
    vector:
      enabled: true
      
      model:
        name: paraphrase-multilingual
        
        # æ¨¡å‹æ–‡ä»¶è·¯å¾„ï¼ˆç›¸å¯¹äºåº”ç”¨ç›®å½•ï¼‰
        path: ./models/paraphrase-multilingual/model.onnx
```

**æ”¯æŒçš„è·¯å¾„æ ¼å¼**:
1. **ç›¸å¯¹è·¯å¾„ï¼ˆæ¨èï¼‰**: `./models/xxx/model.onnx`
2. **ç»å¯¹è·¯å¾„**: `D:/models/xxx/model.onnx`
3. **Classpathï¼ˆå¼€å‘ç¯å¢ƒï¼‰**: `models/xxx/model.onnx`

---

## ğŸ“ Release ç›®å½•ç»“æ„

```
release/
â”œâ”€â”€ ai-reviewer-base-file-rag-1.0.jar      â† ä¸åŒ…å«æ¨¡å‹
â”œâ”€â”€ start.bat                               â† å¯åŠ¨è„šæœ¬
â”œâ”€â”€ stop.bat                                â† åœæ­¢è„šæœ¬
â”œâ”€â”€ README.md
â”œâ”€â”€ æ¨¡å‹ä¸‹è½½è¯´æ˜.md
â”œâ”€â”€ config/
â”‚   â””â”€â”€ application.yml                     â† é…ç½®æ–‡ä»¶
â”œâ”€â”€ models/                                 â† å¤–éƒ¨æ¨¡å‹ç›®å½•
â”‚   â”œâ”€â”€ paraphrase-multilingual/
â”‚   â”‚   â””â”€â”€ model.onnx                     â† æ¨¡å‹æ–‡ä»¶
â”‚   â”œâ”€â”€ text2vec-base-chinese/
â”‚   â”‚   â””â”€â”€ model.onnx
â”‚   â””â”€â”€ bge-m3/
â”‚       â””â”€â”€ model.onnx
â””â”€â”€ data/
    â”œâ”€â”€ documents/                          â† ä¸Šä¼ çš„æ–‡æ¡£
    â”œâ”€â”€ knowledge-base/                     â† çŸ¥è¯†åº“
    â””â”€â”€ rag/                                â† RAGæ•°æ®
```

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### å¼€å‘ç¯å¢ƒ

```bash
# ç¼–è¯‘ï¼ˆæ¨¡å‹åœ¨ resources ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ï¼‰
mvn clean compile

# è¿è¡Œæµ‹è¯•
mvn test

# å¯åŠ¨åº”ç”¨
mvn spring-boot:run
```

**æ¨¡å‹ä½ç½®**: `src/main/resources/models/`

---

### ç”Ÿäº§ç¯å¢ƒ

```bash
# 1. æ‰“åŒ…ï¼ˆæ¨¡å‹ä¸æ‰“åŒ…è¿›JARï¼‰
mvn clean package -DskipTests

# 2. æ‰‹åŠ¨å¤åˆ¶æ¨¡å‹åˆ° releaseï¼ˆå¦‚æœè‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼‰
Copy-Item -Path "src/main/resources/models" -Destination "release/models" -Recurse -Force

# 3. é…ç½®æ¨¡å‹è·¯å¾„ï¼ˆapplication.ymlï¼‰
#    path: ./models/paraphrase-multilingual/model.onnx

# 4. å¯åŠ¨åº”ç”¨
cd release
download model.bat
```

**æ¨¡å‹ä½ç½®**: `release/models/`

---

## ğŸ”§ æ‰“åŒ…æµç¨‹

### Maven ç”Ÿå‘½å‘¨æœŸ

```
1. mvn clean
   â””â”€ æ¸…ç† target ç›®å½•

2. mvn compile
   â”œâ”€ ç¼–è¯‘ Java ä»£ç 
   â””â”€ å¤åˆ¶ resourcesï¼ˆåŒ…æ‹¬ modelsï¼‰åˆ° target/classes

3. mvn prepare-package
   â”œâ”€ Maven Antrun Plugin æ‰§è¡Œ
   â”œâ”€ åˆ é™¤ target/classes/simpleExcel
   â””â”€ åˆ é™¤ target/classes/models  â† æ¨¡å‹è¢«æ’é™¤

4. mvn package
   â”œâ”€ æ‰“åŒ… JARï¼ˆä¸åŒ…å« modelsï¼‰
   â”œâ”€ Maven Antrun Plugin æ‰§è¡Œ
   â”œâ”€ åˆ›å»º release/models ç›®å½•
   â””â”€ å¤åˆ¶ src/main/resources/models åˆ° release/models

5. ç»“æœ
   â”œâ”€ JAR: target/ai-reviewer-base-file-rag-1.0.jarï¼ˆä¸åŒ…å«æ¨¡å‹ï¼‰
   â””â”€ æ¨¡å‹: release/models/ï¼ˆå¤–éƒ¨æ¨¡å‹æ–‡ä»¶ï¼‰
```

---

## ğŸ’¡ ä¼˜åŠ¿

### 1. JAR åŒ…æ›´å°

| é¡¹ç›® | åŒ…å«æ¨¡å‹ | ä¸åŒ…å«æ¨¡å‹ |
|------|---------|-----------|
| **JAR å¤§å°** | ~200MB | ~50MB âœ… |
| **ä¸‹è½½é€Ÿåº¦** | æ…¢ | å¿« âœ… |
| **éƒ¨ç½²æ—¶é—´** | é•¿ | çŸ­ âœ… |

---

### 2. æ¨¡å‹ç®¡ç†æ›´çµæ´»

- âœ… å¯ä»¥ç‹¬ç«‹æ›´æ–°æ¨¡å‹ï¼Œæ— éœ€é‡æ–°æ‰“åŒ…åº”ç”¨
- âœ… æ”¯æŒå¤šä¸ªæ¨¡å‹ï¼Œæ ¹æ®é…ç½®åˆ‡æ¢
- âœ… æ¨¡å‹æ–‡ä»¶å¯ä»¥å…±äº«ï¼ˆå¤šä¸ªåº”ç”¨ä½¿ç”¨åŒä¸€æ¨¡å‹ï¼‰

---

### 3. ç‰ˆæœ¬æ§åˆ¶å‹å¥½

- âœ… Git ä»“åº“ä¸éœ€è¦å­˜å‚¨å¤§æ–‡ä»¶
- âœ… ä½¿ç”¨ `.gitignore` æ’é™¤æ¨¡å‹æ–‡ä»¶
- âœ… æ¨¡å‹é€šè¿‡æ–‡æ¡£è¯´æ˜ä¸‹è½½

---

### 4. å¼€å‘ä½“éªŒæ›´å¥½

- âœ… å¼€å‘ç¯å¢ƒï¼šç›´æ¥ä½¿ç”¨ `src/main/resources/models`
- âœ… ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨å¤–éƒ¨ `./models` ç›®å½•
- âœ… æ— éœ€æå– JAR å†…æ–‡ä»¶ï¼ŒåŠ è½½é€Ÿåº¦æ›´å¿«

---

## ğŸ“ é…ç½®ç¤ºä¾‹

### åœºæ™¯ 1: ä½¿ç”¨é»˜è®¤æ¨¡å‹ï¼ˆparaphrase-multilingualï¼‰

```yaml
knowledge:
  qa:
    vector:
      enabled: true
      model:
        path: ./models/paraphrase-multilingual/model.onnx
```

### åœºæ™¯ 2: åˆ‡æ¢åˆ°ä¸­æ–‡æ¨¡å‹

```yaml
knowledge:
  qa:
    vector:
      enabled: true
      model:
        path: ./models/text2vec-base-chinese/model.onnx
```

### åœºæ™¯ 3: ä½¿ç”¨ç»å¯¹è·¯å¾„

```yaml
knowledge:
  qa:
    vector:
      enabled: true
      model:
        path: D:/ai-models/bge-m3/model.onnx
```

### åœºæ™¯ 4: å¼€å‘ç¯å¢ƒï¼ˆä½¿ç”¨ classpathï¼‰

```yaml
knowledge:
  qa:
    vector:
      enabled: true
      model:
        path: models/paraphrase-multilingual/model.onnx
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨

**é”™è¯¯æ—¥å¿—**:
```
æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨: ./models/paraphrase-multilingual/model.onnx
```

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥ `release/models` ç›®å½•æ˜¯å¦å­˜åœ¨
2. æ£€æŸ¥æ¨¡å‹æ–‡ä»¶æ˜¯å¦å·²ä¸‹è½½
3. æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾„æ˜¯å¦æ­£ç¡®

```powershell
# æ£€æŸ¥æ¨¡å‹æ–‡ä»¶
ls release/models -Recurse -File

# å¦‚æœä¸å­˜åœ¨ï¼Œæ‰‹åŠ¨å¤åˆ¶
Copy-Item -Path "src/main/resources/models" -Destination "release/models" -Recurse -Force
```

---

### é—®é¢˜ 2: æ‰“åŒ…å models ç›®å½•ä¸ºç©º

**åŸå› **: Maven Antrun Plugin å¤åˆ¶å¤±è´¥ï¼ˆ`failonerror="false"`ï¼‰

**è§£å†³æ–¹æ³•**: æ‰‹åŠ¨å¤åˆ¶

```powershell
# PowerShell
cd D:\Jetbrains\hackathon\AI-Reviewer\ai-reviewer-base-file-rag
Copy-Item -Path "src/main/resources/models" -Destination "release/models" -Recurse -Force
```

```bash
# Bash
cd /path/to/ai-reviewer-base-file-rag
cp -r src/main/resources/models release/models
```

---

### é—®é¢˜ 3: JAR ä¸­ä»ç„¶åŒ…å« models

**æ£€æŸ¥æ–¹æ³•**:
```bash
jar tf target/ai-reviewer-base-file-rag-1.0.jar | grep models
```

**å¦‚æœæœ‰è¾“å‡º**:
1. æ£€æŸ¥ `pom.xml` ä¸­çš„ Maven Antrun Plugin é…ç½®
2. ç¡®è®¤ `prepare-package` é˜¶æ®µæ‰§è¡Œäº†åˆ é™¤æ“ä½œ
3. æ¸…ç†åé‡æ–°æ‰“åŒ…ï¼š

```bash
mvn clean package -DskipTests
```

---

## âœ… éªŒè¯æ¸…å•

### æ‰“åŒ…éªŒè¯

- [ ] JAR åŒ…ä¸åŒ…å« `models` ç›®å½•
  ```bash
  jar tf target/*.jar | grep models
  # åº”è¯¥æ— è¾“å‡º
  ```

- [ ] `release/models` ç›®å½•å­˜åœ¨
  ```bash
  ls release/models
  ```

- [ ] æ¨¡å‹æ–‡ä»¶å®Œæ•´
  ```bash
  ls release/models/paraphrase-multilingual/model.onnx
  ```

---

### è¿è¡ŒéªŒè¯

- [ ] å¯åŠ¨åº”ç”¨æˆåŠŸ
  ```bash
  cd release
  ./download model.bat
  ```

- [ ] æ—¥å¿—æ˜¾ç¤ºæ¨¡å‹åŠ è½½æˆåŠŸ
  ```
  âœ… ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½æ¨¡å‹: ./models/paraphrase-multilingual/model.onnx
  âœ… æœ¬åœ°åµŒå…¥æ¨¡å‹å·²åŠ è½½
     - æ¨¡å‹: paraphrase-multilingual
     - ç»´åº¦: 384
  ```

- [ ] å‘é‡æ£€ç´¢åŠŸèƒ½æ­£å¸¸
  ```
  # è®¿é—® http://localhost:8080
  # è¿›è¡Œé—®ç­”æµ‹è¯•
  ```

---

<div align="center">

## ğŸ‰ é…ç½®å®Œæˆï¼

ç°åœ¨æ¨¡å‹æ–‡ä»¶å·²å¤–ç½®ï¼ŒJAR åŒ…æ›´å°ï¼Œéƒ¨ç½²æ›´çµæ´»ï¼

**æ‰“åŒ…å‘½ä»¤**:
```bash
mvn clean package -DskipTests
```

**å¯åŠ¨åº”ç”¨**:
```bash
cd release
download model.bat
```

**æ¨¡å‹è·¯å¾„**: `release/models/`

Made with â¤ï¸ by AI Assistant  
2025-11-23

</div>

