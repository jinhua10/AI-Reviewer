# å‘é‡åµŒå…¥æ¨¡å‹ä¸‹è½½æŒ‡å—

## ğŸ“¥ å¿«é€Ÿå¼€å§‹

å‘é‡æ£€ç´¢åŠŸèƒ½éœ€è¦æœ¬åœ°çš„ Sentence-BERT æ¨¡å‹ã€‚æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ä¸‹è½½æ¨¡å‹ï¼š

---

## æ–¹å¼ä¸€ï¼šä½¿ç”¨ Python è½¬æ¢ï¼ˆæ¨èï¼‰

### æ­¥éª¤ 1: å®‰è£…ä¾èµ–

```bash
pip install transformers onnx onnxruntime optimum
```

### æ­¥éª¤ 2: ä¸‹è½½å¹¶è½¬æ¢æ¨¡å‹

**å¤šè¯­è¨€æ¨¡å‹ï¼ˆæ¨è - æ”¯æŒä¸­è‹±æ–‡æ··åˆï¼‰ï¼š**

```python
from optimum.onnxruntime import ORTModelForFeatureExtraction
from transformers import AutoTokenizer

# ä¸‹è½½æ¨¡å‹
model_name = "sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2"
model = ORTModelForFeatureExtraction.from_pretrained(model_name, export=True)
tokenizer = AutoTokenizer.from_pretrained(model_name)

# ä¿å­˜åˆ°é¡¹ç›®ç›®å½•
output_dir = "./models/paraphrase-multilingual"
model.save_pretrained(output_dir)
tokenizer.save_pretrained(output_dir)

print(f"âœ… æ¨¡å‹å·²ä¿å­˜åˆ°: {output_dir}")
```

**çº¯ä¸­æ–‡æ¨¡å‹ï¼ˆä»…ä¸­æ–‡åœºæ™¯ï¼‰ï¼š**

```python
model_name = "shibing624/text2vec-base-chinese"
model = ORTModelForFeatureExtraction.from_pretrained(model_name, export=True)
tokenizer = AutoTokenizer.from_pretrained(model_name)

output_dir = "./models/text2vec-base-chinese"
model.save_pretrained(output_dir)
tokenizer.save_pretrained(output_dir)
```

**çº¯è‹±æ–‡æ¨¡å‹ï¼š**

```python
model_name = "sentence-transformers/all-MiniLM-L6-v2"
model = ORTModelForFeatureExtraction.from_pretrained(model_name, export=True)
tokenizer = AutoTokenizer.from_pretrained(model_name)

output_dir = "./models/all-MiniLM-L6-v2"
model.save_pretrained(output_dir)
tokenizer.save_pretrained(output_dir)
```

---

## æ–¹å¼äºŒï¼šæ‰‹åŠ¨ä¸‹è½½é¢„è½¬æ¢æ¨¡å‹

### å¤šè¯­è¨€æ¨¡å‹ï¼ˆæ¨èï¼‰

1. è®¿é—®ï¼šhttps://huggingface.co/sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2
2. ä¸‹è½½ä»¥ä¸‹æ–‡ä»¶åˆ° `./models/paraphrase-multilingual/` ç›®å½•ï¼š
   - `model.onnx` ï¼ˆå¿…éœ€ï¼Œéœ€è¦è½¬æ¢ï¼‰
   - `tokenizer.json` ï¼ˆå¯é€‰ï¼‰
   - `config.json` ï¼ˆå¯é€‰ï¼‰

### çº¯ä¸­æ–‡æ¨¡å‹

1. è®¿é—®ï¼šhttps://huggingface.co/shibing624/text2vec-base-chinese
2. ä¸‹è½½ä»¥ä¸‹æ–‡ä»¶åˆ° `./models/text2vec-base-chinese/` ç›®å½•ï¼š
   - `model.onnx` ï¼ˆå¿…éœ€ï¼‰
   - `tokenizer.json` ï¼ˆå¯é€‰ï¼‰
   - `config.json` ï¼ˆå¯é€‰ï¼‰

### çº¯è‹±æ–‡æ¨¡å‹

1. è®¿é—®ï¼šhttps://huggingface.co/sentence-transformers/all-MiniLM-L6-v2
2. ä¸‹è½½ ONNX ç‰ˆæœ¬çš„æ–‡ä»¶

---

## ğŸ“‚ ç›®å½•ç»“æ„

åˆ›å»ºä»¥ä¸‹ç›®å½•ç»“æ„ï¼š

```
AI-Reviewer/
â”œâ”€â”€ ai-reviewer-base-file-rag/
â”‚   â””â”€â”€ models/
â”‚       â””â”€â”€ paraphrase-multilingual/      # æ¨èï¼šå¤šè¯­è¨€æ¨¡å‹
â”‚           â”œâ”€â”€ model.onnx                 # å¿…éœ€ï¼šONNX æ¨¡å‹æ–‡ä»¶
â”‚           â”œâ”€â”€ tokenizer.json             # å¯é€‰ï¼šåˆ†è¯å™¨é…ç½®
â”‚           â””â”€â”€ config.json                # å¯é€‰ï¼šæ¨¡å‹é…ç½®
```

---

## âœ… éªŒè¯å®‰è£…

è¿è¡Œæµ‹è¯•ç¨‹åºéªŒè¯æ¨¡å‹æ˜¯å¦æ­£ç¡®åŠ è½½ï¼š

```bash
cd ai-reviewer-base-file-rag
mvn compile exec:java -Dexec.mainClass=top.yumbo.ai.rag.impl.embedding.LocalEmbeddingEngine
```

æœŸæœ›è¾“å‡ºï¼š

```
âœ… æœ¬åœ°åµŒå…¥æ¨¡å‹å·²åŠ è½½
   - æ¨¡å‹: paraphrase-multilingual-MiniLM-L12-v2
   - è·¯å¾„: ./models/paraphrase-multilingual/model.onnx
   - ç»´åº¦: 384
   - æœ€å¤§åºåˆ—é•¿åº¦: 128

æ–‡æœ¬: äººå·¥æ™ºèƒ½æ­£åœ¨æ”¹å˜ä¸–ç•Œ
å‘é‡ç»´åº¦: 384
å‘é‡å‰10ç»´: [0.12, -0.34, 0.56, ...]
```

---

## ğŸš¨ å¸¸è§é—®é¢˜

### Q: æç¤º "æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨"

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼š`./models/paraphrase-multilingual/model.onnx`
2. ç¡®è®¤æ–‡ä»¶å·²ä¸‹è½½ä¸”å‘½åæ­£ç¡®
3. æ£€æŸ¥æ–‡ä»¶æƒé™

### Q: æç¤º "ONNX Runtime é”™è¯¯"

**è§£å†³æ–¹æ³•ï¼š**
1. ç¡®è®¤ ONNX Runtime ä¾èµ–å·²æ·»åŠ åˆ° pom.xml
2. æ£€æŸ¥ ONNX æ¨¡å‹ç‰ˆæœ¬ä¸ ONNX Runtime ç‰ˆæœ¬å…¼å®¹
3. å°è¯•ä½¿ç”¨ä¸åŒçš„æ¨¡å‹

### Q: æ¨ç†é€Ÿåº¦å¾ˆæ…¢

**ä¼˜åŒ–æ–¹æ³•ï¼š**
1. ä½¿ç”¨ CPU ä¼˜åŒ–ç‰ˆæœ¬ï¼š`onnxruntime-extensions`
2. å¦‚æœ‰ GPUï¼Œä½¿ç”¨ï¼š`onnxruntime-gpu`
3. å‡å°‘æœ€å¤§åºåˆ—é•¿åº¦

### Q: å†…å­˜ä¸è¶³

**è§£å†³æ–¹æ³•ï¼š**
1. å¢åŠ  JVM å †å†…å­˜ï¼š`-Xmx4g`
2. ä½¿ç”¨æ›´å°çš„æ¨¡å‹
3. å‡å°æ‰¹å¤„ç†å¤§å°

---

## ğŸ“Š æ¨¡å‹å¯¹æ¯”

| æ¨¡å‹ | è¯­è¨€ | ç»´åº¦ | æ–‡ä»¶å¤§å° | é€Ÿåº¦ | å‡†ç¡®ç‡ |
|------|------|------|---------|------|--------|
| text2vec-base-chinese | ä¸­æ–‡ | 384 | ~400MB | å¿« | â­â­â­â­ |
| all-MiniLM-L6-v2 | è‹±æ–‡ | 384 | ~80MB | å¿« | â­â­â­â­ |
| paraphrase-multilingual | å¤šè¯­è¨€ | 384 | ~280MB | ä¸­ | â­â­â­â­â­ |

**æ¨èé€‰æ‹©ï¼š**
- çº¯ä¸­æ–‡åœºæ™¯ï¼š`text2vec-base-chinese`
- çº¯è‹±æ–‡åœºæ™¯ï¼š`all-MiniLM-L6-v2`  
- ä¸­è‹±æ··åˆï¼š`paraphrase-multilingual-MiniLM-L12-v2`

---

## ğŸ”§ è‡ªå®šä¹‰æ¨¡å‹è·¯å¾„

å¦‚æœæ¨¡å‹æ”¾åœ¨å…¶ä»–ä½ç½®ï¼Œä¿®æ”¹é…ç½®ï¼š

```java
LocalEmbeddingEngine engine = new LocalEmbeddingEngine(
    "/path/to/your/model.onnx",  // è‡ªå®šä¹‰è·¯å¾„
    512                           // æœ€å¤§åºåˆ—é•¿åº¦
);
```

---

## ğŸ“š æ›´å¤šèµ„æº

- ONNX Runtime Java: https://onnxruntime.ai/docs/get-started/with-java.html
- Sentence Transformers: https://www.sbert.net/
- HuggingFace Models: https://huggingface.co/models?library=sentence-transformers

---

## âœ¨ æç¤º

1. é¦–æ¬¡è¿è¡Œä¼šæ¯”è¾ƒæ…¢ï¼ˆæ¨¡å‹åŠ è½½ï¼‰
2. åç»­è°ƒç”¨ä¼šå¿«å¾ˆå¤šï¼ˆæ¨¡å‹å·²åœ¨å†…å­˜ï¼‰
3. å»ºè®®ä½¿ç”¨ SSD å­˜å‚¨æ¨¡å‹æ–‡ä»¶
4. ç”Ÿäº§ç¯å¢ƒå»ºè®®é¢„çƒ­æ¨¡å‹ï¼ˆæå‰åŠ è½½ï¼‰

