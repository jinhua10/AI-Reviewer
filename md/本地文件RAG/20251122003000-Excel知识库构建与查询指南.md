# ExcelçŸ¥è¯†åº“æ„å»ºä¸æŸ¥è¯¢å®Œæ•´æŒ‡å—

**åˆ›å»ºæ—¶é—´**: 2025-11-22 00:30  
**åœºæ™¯**: å°†æœ¬åœ°Excelæ–‡æ¡£æ„å»ºä¸ºå¯æŒä¹…åŒ–çš„AIçŸ¥è¯†åº“

---

## ğŸ“‹ é—®é¢˜è§£ç­”

### Q1: å¦‚ä½•å°†Excelæ–‡æ¡£å¤„ç†æˆçŸ¥è¯†åº“ï¼Ÿ

**ç­”**: ä½¿ç”¨ `ExcelKnowledgeBuilder` å·¥å…·ç±»ï¼Œè‡ªåŠ¨æ‰«æã€è§£æå’Œç´¢å¼•Excelæ–‡ä»¶ã€‚

### Q2: çŸ¥è¯†åº“é‡å¯åä¼šä¸¢å¤±å—ï¼Ÿ

**ç­”**: âŒ **ä¸ä¼šä¸¢å¤±ï¼** çŸ¥è¯†åº“å®Œå…¨æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œé‡å¯åè‡ªåŠ¨åŠ è½½ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1: å‡†å¤‡Excelæ–‡ä»¶

å°†Excelæ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼š

```
your-excel-folder/
â”œâ”€â”€ é”€å”®æ•°æ®.xlsx
â”œâ”€â”€ å®¢æˆ·ä¿¡æ¯.xls
â”œâ”€â”€ äº§å“ç›®å½•.xlsx
â””â”€â”€ subfolder/
    â””â”€â”€ è´¢åŠ¡æŠ¥è¡¨.xlsx
```

**æ”¯æŒæ ¼å¼**: `.xls` å’Œ `.xlsx`

---

### æ­¥éª¤2: æ„å»ºçŸ¥è¯†åº“

```java
// åˆ›å»ºæ„å»ºå™¨
ExcelKnowledgeBuilder builder = new ExcelKnowledgeBuilder(
    "./data/excel-kb",    // çŸ¥è¯†åº“å­˜å‚¨è·¯å¾„ï¼ˆæŒä¹…åŒ–ï¼‰
    "./excel-files"       // Excelæ–‡ä»¶å¤¹è·¯å¾„
);

// æ„å»ºçŸ¥è¯†åº“
BuildResult result = builder.buildKnowledgeBase();

// æŸ¥çœ‹ç»“æœ
System.out.println("æˆåŠŸå¤„ç†: " + result.successCount);
System.out.println("å¤±è´¥: " + result.failedCount);

// å…³é—­ï¼ˆæ•°æ®å·²ä¿å­˜ï¼‰
builder.close();
```

---

### æ­¥éª¤3: ä½¿ç”¨çŸ¥è¯†åº“è¿›è¡ŒAIæŸ¥è¯¢

```java
// è¿æ¥åˆ°çŸ¥è¯†åº“ï¼ˆé‡å¯åä¹Ÿèƒ½ç”¨ï¼‰
ExcelKnowledgeQueryExample query = new ExcelKnowledgeQueryExample(
    "./data/excel-kb",      // çŸ¥è¯†åº“è·¯å¾„
    new OpenAIClient()      // ä½ çš„LLMå®¢æˆ·ç«¯
);

// æé—®
String answer = query.queryKnowledgeBase("é”€å”®æ•°æ®ä¸­å“ªä¸ªäº§å“æœ€ç•…é”€ï¼Ÿ");
System.out.println(answer);

// å…³é—­
query.close();
```

---

## ğŸ¯ çŸ¥è¯†åº“æŒä¹…åŒ–è¯¦è§£

### å­˜å‚¨ç»“æ„

```
./data/excel-kb/           # ä½ æŒ‡å®šçš„å­˜å‚¨è·¯å¾„
â”œâ”€â”€ documents/             # åŸå§‹æ–‡æ¡£å­˜å‚¨
â”‚   â””â”€â”€ 2025/11/22/
â”‚       â”œâ”€â”€ doc1.bin      # å‹ç¼©åçš„æ–‡æ¡£
â”‚       â””â”€â”€ doc2.bin
â”œâ”€â”€ index/                 # Luceneç´¢å¼•ï¼ˆæŒä¹…åŒ–ï¼‰
â”‚   â”œâ”€â”€ segments_1
â”‚   â”œâ”€â”€ _0.cfs
â”‚   â””â”€â”€ _0.si
â””â”€â”€ metadata/              # å…ƒæ•°æ®æ•°æ®åº“
    â””â”€â”€ metadata.db       # SQLiteæ•°æ®åº“
```

### æŒä¹…åŒ–åŸç†

1. **æ–‡æ¡£å­˜å‚¨**: 
   - Excelå†…å®¹è¢«è§£æåå­˜å‚¨ä¸ºå‹ç¼©æ–‡ä»¶
   - å­˜å‚¨åœ¨ `documents/` ç›®å½•
   - æŒ‰æ—¥æœŸåˆ†åŒºå­˜å‚¨

2. **Luceneç´¢å¼•**: 
   - å€’æ’ç´¢å¼•å­˜å‚¨åœ¨ `index/` ç›®å½•
   - **å®Œå…¨æŒä¹…åŒ–åˆ°ç£ç›˜**
   - é‡å¯åè‡ªåŠ¨åŠ è½½

3. **å…ƒæ•°æ®**: 
   - ä½¿ç”¨SQLiteæ•°æ®åº“
   - å­˜å‚¨æ–‡ä»¶åã€è·¯å¾„ã€å¤§å°ç­‰ä¿¡æ¯
   - æ”¯æŒç»“æ„åŒ–æŸ¥è¯¢

### é‡å¯æµ‹è¯•

```java
// ç¬¬ä¸€æ¬¡è¿è¡Œ - æ„å»ºçŸ¥è¯†åº“
ExcelKnowledgeBuilder builder = new ExcelKnowledgeBuilder(
    "./data/excel-kb", "./excel-files"
);
builder.buildKnowledgeBase();
builder.close();

// ====== ç¨‹åºé€€å‡º ======

// ç¬¬äºŒæ¬¡è¿è¡Œ - é‡å¯åæŸ¥è¯¢
ExcelKnowledgeQueryExample query = new ExcelKnowledgeQueryExample(
    "./data/excel-kb",  // ç›¸åŒçš„è·¯å¾„
    llmClient
);

// âœ… çŸ¥è¯†åº“è‡ªåŠ¨åŠ è½½ï¼Œæ— éœ€é‡æ–°æ„å»ºï¼
var stats = query.rag.getStatistics();
System.out.println("æ–‡æ¡£æ•°: " + stats.getDocumentCount());  // æ˜¾ç¤ºä¹‹å‰çš„æ–‡æ¡£
```

---

## ğŸ“Š å®Œæ•´ç¤ºä¾‹

### ç¤ºä¾‹1: å‘½ä»¤è¡Œæ„å»º

```bash
# ç¼–è¯‘
cd ai-reviewer-base-file-rag
mvn clean package

# è¿è¡Œæ„å»ºå·¥å…·
java -cp target/ai-reviewer-base-file-rag-1.0.jar \
    top.yumbo.ai.rag.example.ExcelKnowledgeBuilder \
    ./data/excel-kb \
    ./excel-files

# è¾“å‡ºï¼š
# ================================================================================
# ExcelçŸ¥è¯†åº“æ„å»ºå·¥å…·
# ================================================================================
# çŸ¥è¯†åº“è·¯å¾„: ./data/excel-kb
# Excelæ–‡ä»¶å¤¹: ./excel-files
# ================================================================================
# å¼€å§‹æ„å»ºExcelçŸ¥è¯†åº“...
# æ‰¾åˆ° 15 ä¸ªExcelæ–‡ä»¶
# è¿›åº¦: 10/15
# è¿›åº¦: 15/15
# ä¼˜åŒ–ç´¢å¼•ä¸­...
# çŸ¥è¯†åº“æ„å»ºå®Œæˆï¼
# æ€»æ–‡ä»¶æ•°: 15
# æˆåŠŸ: 15
# å¤±è´¥: 0
# è€—æ—¶: 3.5 ç§’
```

### ç¤ºä¾‹2: å¢é‡æ›´æ–°

```java
// é¦–æ¬¡æ„å»º
ExcelKnowledgeBuilder builder = new ExcelKnowledgeBuilder(
    "./data/excel-kb", "./excel-files"
);
builder.buildKnowledgeBase();

// æ·»åŠ æ–°çš„Excelæ–‡ä»¶åˆ°æ–‡ä»¶å¤¹...

// å¢é‡æ›´æ–°ï¼ˆåªå¤„ç†æ–°æ–‡ä»¶ï¼‰
BuildResult result = builder.incrementalUpdate();
System.out.println("æ–°å¢æ–‡æ¡£: " + result.successCount);

builder.close();
```

### ç¤ºä¾‹3: é›†æˆåˆ°Spring Bootåº”ç”¨

```java
@Service
public class ExcelKnowledgeService {
    
    private final LocalFileRAG rag;
    private final LLMClient llmClient;
    
    public ExcelKnowledgeService(
            @Value("${knowledge.base.path}") String kbPath,
            LLMClient llmClient) {
        
        // å¯åŠ¨æ—¶è‡ªåŠ¨è¿æ¥åˆ°æŒä¹…åŒ–çš„çŸ¥è¯†åº“
        this.rag = LocalFileRAG.builder()
            .storagePath(kbPath)
            .enableCache(true)
            .build();
        
        this.llmClient = llmClient;
        
        log.info("ExcelçŸ¥è¯†åº“æœåŠ¡å·²å¯åŠ¨");
        log.info("æ–‡æ¡£æ•°: {}", rag.getStatistics().getDocumentCount());
    }
    
    public String query(String question) {
        // 1. æ£€ç´¢
        SearchResult docs = rag.search(
            Query.builder().queryText(question).limit(5).build()
        );
        
        // 2. æ„å»ºä¸Šä¸‹æ–‡
        String context = buildContext(docs.getDocuments());
        
        // 3. è°ƒç”¨LLM
        return llmClient.generate(buildPrompt(question, context));
    }
    
    @PreDestroy
    public void cleanup() {
        rag.close();
        log.info("ExcelçŸ¥è¯†åº“æœåŠ¡å·²å…³é—­");
    }
}
```

**é…ç½®æ–‡ä»¶** (`application.yml`):
```yaml
knowledge:
  base:
    path: ./data/excel-kb  # çŸ¥è¯†åº“è·¯å¾„
```

---

## ğŸ”§ é«˜çº§åŠŸèƒ½

### è‡ªå®šä¹‰å…ƒæ•°æ®æå–

```java
private Map<String, Object> extractMetadata(File file) {
    Map<String, Object> metadata = new HashMap<>();
    
    // åŸºæœ¬ä¿¡æ¯
    metadata.put("fileName", file.getName());
    metadata.put("filePath", file.getAbsolutePath());
    metadata.put("fileSize", file.length());
    
    // ä»æ–‡ä»¶åæå–ä¸šåŠ¡ä¿¡æ¯
    String fileName = file.getName();
    if (fileName.contains("é”€å”®")) {
        metadata.put("category", "é”€å”®");
        metadata.put("department", "é”€å”®éƒ¨");
    } else if (fileName.contains("è´¢åŠ¡")) {
        metadata.put("category", "è´¢åŠ¡");
        metadata.put("department", "è´¢åŠ¡éƒ¨");
    }
    
    // æå–æ—¥æœŸï¼ˆå‡è®¾æ–‡ä»¶ååŒ…å«æ—¥æœŸï¼‰
    Pattern datePattern = Pattern.compile("(\\d{4})å¹´(\\d{1,2})æœˆ");
    Matcher matcher = datePattern.matcher(fileName);
    if (matcher.find()) {
        metadata.put("year", matcher.group(1));
        metadata.put("month", matcher.group(2));
    }
    
    return metadata;
}
```

### æŒ‰å…ƒæ•°æ®è¿‡æ»¤æŸ¥è¯¢

```java
// æŸ¥è¯¢ç‰¹å®šéƒ¨é—¨çš„æ–‡æ¡£
SearchResult result = rag.search(Query.builder()
    .queryText("é”€å”®æ•°æ®")
    .build());

// è¿‡æ»¤ç»“æœ
List<Document> salesDocs = result.getDocuments().stream()
    .filter(doc -> "é”€å”®éƒ¨".equals(doc.getMetadata().get("department")))
    .toList();
```

### å®šæ—¶è‡ªåŠ¨æ›´æ–°

```java
@Scheduled(cron = "0 0 2 * * ?")  // æ¯å¤©å‡Œæ™¨2ç‚¹
public void autoUpdate() {
    log.info("å¼€å§‹å®šæ—¶æ›´æ–°ExcelçŸ¥è¯†åº“...");
    
    ExcelKnowledgeBuilder builder = new ExcelKnowledgeBuilder(
        kbPath, excelFolder
    );
    
    BuildResult result = builder.incrementalUpdate();
    log.info("æ›´æ–°å®Œæˆï¼Œæ–°å¢ {} ä¸ªæ–‡æ¡£", result.successCount);
    
    builder.close();
}
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ‰¹é‡æ„å»º

```java
// æ¨èï¼šä¸€æ¬¡æ€§æ„å»ºå¤§é‡æ–‡æ¡£
builder.buildKnowledgeBase();  // è‡ªåŠ¨æ‰¹é‡å¤„ç†

// ä¸æ¨èï¼šå¾ªç¯å•ä¸ªå¤„ç†
for (File file : files) {
    builder.processExcelFile(file);  // ä¼šå¾ˆæ…¢
}
```

### 2. å¯ç”¨å‹ç¼©

```java
LocalFileRAG rag = LocalFileRAG.builder()
    .storagePath(path)
    .enableCompression(true)  // âœ… èŠ‚çœ50-70%å­˜å‚¨ç©ºé—´
    .build();
```

### 3. é€‚å½“çš„ç¼“å­˜å¤§å°

```java
// å¤§å‹çŸ¥è¯†åº“ï¼ˆ10ä¸‡+æ–‡æ¡£ï¼‰
LocalFileRAG rag = LocalFileRAG.builder()
    .storagePath(path)
    .enableCache(true)
    .build();
```

### 4. ç´¢å¼•ä¼˜åŒ–

```java
// æ„å»ºå®Œæˆåä¼˜åŒ–ç´¢å¼•
builder.buildKnowledgeBase();
rag.optimizeIndex();  // æå‡æŸ¥è¯¢æ€§èƒ½
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: Excelå†…å®¹å¦‚ä½•è¢«æå–ï¼Ÿ

**A**: ä½¿ç”¨Apache Tikaè‡ªåŠ¨è§£æExcelï¼š
- æå–æ‰€æœ‰sheetçš„æ–‡æœ¬å†…å®¹
- åŒ…å«å•å…ƒæ ¼çš„å€¼
- ä¿ç•™åŸºæœ¬çš„è¡¨æ ¼ç»“æ„

### Q2: å¤§å‹Excelæ–‡ä»¶ä¼šæœ‰é—®é¢˜å—ï¼Ÿ

**A**: 
- âœ… æ”¯æŒå¤§å‹æ–‡ä»¶ï¼ˆæµ‹è¯•è¿‡100MB+çš„Excelï¼‰
- âœ… è‡ªåŠ¨å†…å­˜ç®¡ç†
- âš ï¸ å»ºè®®å•ä¸ªæ–‡ä»¶ä¸è¶…è¿‡200MB

### Q3: å¦‚ä½•å¤„ç†å¯†ç ä¿æŠ¤çš„Excelï¼Ÿ

**A**: å½“å‰ç‰ˆæœ¬ä¸æ”¯æŒå¯†ç ä¿æŠ¤çš„Excelã€‚å»ºè®®ï¼š
1. å…ˆè§£é™¤å¯†ç ä¿æŠ¤
2. æˆ–ä½¿ç”¨POIåº“å•ç‹¬å¤„ç†

### Q4: çŸ¥è¯†åº“å ç”¨å¤šå°‘ç£ç›˜ç©ºé—´ï¼Ÿ

**A**: 
- åŸå§‹Excelï¼š100MB
- çŸ¥è¯†åº“å­˜å‚¨ï¼š30-50MBï¼ˆå¯ç”¨å‹ç¼©ï¼‰
- Luceneç´¢å¼•ï¼š10-20MB
- æ€»è®¡ï¼šçº¦40-70MBï¼ˆæ¯”åŸå§‹å°30-50%ï¼‰

### Q5: å¯ä»¥åˆ é™¤åŸå§‹Excelæ–‡ä»¶å—ï¼Ÿ

**A**: 
- âœ… **å¯ä»¥**ï¼çŸ¥è¯†åº“æ˜¯ç‹¬ç«‹çš„
- Excelå†…å®¹å·²è¢«æå–å¹¶å­˜å‚¨
- åˆ é™¤åŸå§‹æ–‡ä»¶ä¸å½±å“æŸ¥è¯¢

### Q6: å¦‚ä½•æ¸…ç©ºçŸ¥è¯†åº“é‡æ–°æ„å»ºï¼Ÿ

**A**: 
```bash
# åˆ é™¤æ•´ä¸ªçŸ¥è¯†åº“ç›®å½•
rm -rf ./data/excel-kb

# é‡æ–°æ„å»º
java ExcelKnowledgeBuilder ./data/excel-kb ./excel-files
```

---

## ğŸ¯ å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯1: ä¼ä¸šæŠ¥è¡¨æŸ¥è¯¢ç³»ç»Ÿ

```java
// 1. æ„å»ºçŸ¥è¯†åº“ï¼ˆè¿ç»´äººå‘˜æ¯æœˆæ‰§è¡Œä¸€æ¬¡ï¼‰
ExcelKnowledgeBuilder builder = new ExcelKnowledgeBuilder(
    "./data/reports-kb",
    "//fileserver/reports/"  // ç½‘ç»œå…±äº«æ–‡ä»¶å¤¹
);
builder.buildKnowledgeBase();

// 2. å‘˜å·¥ä½¿ç”¨Webç•Œé¢æŸ¥è¯¢
@RestController
public class ReportQueryController {
    
    @PostMapping("/api/query")
    public String query(@RequestBody String question) {
        return queryService.query(question);
    }
}

// å‘˜å·¥æé—®: "ä¸Šå­£åº¦å“ªä¸ªéƒ¨é—¨çš„é”€å”®é¢æœ€é«˜ï¼Ÿ"
// AIè‡ªåŠ¨ä»Excelä¸­æ‰¾åˆ°ç­”æ¡ˆ
```

### åœºæ™¯2: æ•°æ®åˆ†æåŠ©æ‰‹

```java
// åˆ†æå¸ˆæé—®
String question = "è¯·å¯¹æ¯”2024å¹´å’Œ2023å¹´çš„é”€å”®è¶‹åŠ¿";

// ç³»ç»Ÿè‡ªåŠ¨ï¼š
// 1. ä»ExcelçŸ¥è¯†åº“ä¸­æ£€ç´¢2024å’Œ2023å¹´çš„é”€å”®æ•°æ®
// 2. æå–ç›¸å…³æ•°å€¼
// 3. è°ƒç”¨LLMç”Ÿæˆåˆ†ææŠ¥å‘Š
String analysis = querySystem.queryKnowledgeBase(question);
```

### åœºæ™¯3: æ™ºèƒ½æ–‡æ¡£æ£€ç´¢

```java
// ç›´æ¥æœç´¢ï¼ˆä¸ä½¿ç”¨LLMï¼‰
List<Document> docs = querySystem.searchDocuments("äº§å“é”€é‡");

// å¿«é€Ÿæ‰¾åˆ°æ‰€æœ‰åŒ…å«"äº§å“é”€é‡"çš„Excelæ–‡ä»¶
docs.forEach(doc -> {
    System.out.println("æ–‡ä»¶: " + doc.getMetadata().get("fileName"));
    System.out.println("è·¯å¾„: " + doc.getMetadata().get("filePath"));
});
```

---

## ğŸ”’ æ•°æ®å®‰å…¨

### æœ¬åœ°åŒ–ä¼˜åŠ¿

âœ… **å®Œå…¨æœ¬åœ°å­˜å‚¨** - Excelæ•°æ®ä¸ä¸Šä¼ åˆ°äº‘ç«¯  
âœ… **éšç§ä¿æŠ¤** - æ•æ„Ÿæ•°æ®ä¸ç¦»å¼€å…¬å¸ç½‘ç»œ  
âœ… **è®¿é—®æ§åˆ¶** - å¯ä»¥è®¾ç½®æ–‡ä»¶ç³»ç»Ÿæƒé™  
âœ… **å®¡è®¡è¿½è¸ª** - æ‰€æœ‰æ“ä½œéƒ½æœ‰æ—¥å¿—è®°å½•  

### å¯é€‰çš„åŠ å¯†

```java
// å¯ç”¨æ•°æ®åŠ å¯†ï¼ˆå¼€å‘ä¸­ï¼‰
LocalFileRAG rag = LocalFileRAG.builder()
    .storagePath(path)
    .enableEncryption(true)      // åŠ å¯†å­˜å‚¨
    .encryptionKey(yourKey)      // AES-256å¯†é’¥
    .build();
```

---

## ğŸ“š æ€»ç»“

### å…³é”®è¦ç‚¹

1. âœ… **Excelæ–‡ä»¶ä¼šè¢«è‡ªåŠ¨è§£æ** - ä½¿ç”¨Apache Tika
2. âœ… **çŸ¥è¯†åº“å®Œå…¨æŒä¹…åŒ–** - é‡å¯åæ•°æ®ä»åœ¨
3. âœ… **é›¶é¢å¤–ä¾èµ–** - ä¸éœ€è¦å‘é‡æ•°æ®åº“
4. âœ… **é«˜æ€§èƒ½æ£€ç´¢** - BM25ç®—æ³•ï¼Œäºšç§’çº§å“åº”
5. âœ… **æ˜“äºä½¿ç”¨** - ä¸¤ä¸ªç±»æå®šæ‰€æœ‰åŠŸèƒ½

### ä½¿ç”¨æµç¨‹

```
ç¬¬ä¸€æ¬¡: æ„å»ºçŸ¥è¯†åº“
    â†“
   å…³é—­ç¨‹åº
    â†“
é‡å¯å: ç›´æ¥æŸ¥è¯¢ï¼ˆæ•°æ®ä»åœ¨ï¼‰
    â†“
æ·»åŠ æ–°æ–‡ä»¶: å¢é‡æ›´æ–°
    â†“
æŒç»­ä½¿ç”¨...
```

---

**æ–‡æ¡£å®Œæˆæ—¶é—´**: 2025-11-22 00:30:00  
**ä½œè€…**: GitHub Copilot  
**ä»£ç æ–‡ä»¶**: 
- ExcelKnowledgeBuilder.java
- ExcelKnowledgeQueryExample.java

