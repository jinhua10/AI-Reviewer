# ğŸ–¼ï¸ å›¾ç‰‡è½¬æ–‡æœ¬åŠŸèƒ½å®ç°æ–¹æ¡ˆ

## ğŸ“Š æ–¹æ¡ˆæ¦‚è¿°

é’ˆå¯¹æ–‡æ¡£ä¸­çš„å›¾ç‰‡å†…å®¹æå–é—®é¢˜ï¼Œå®ç°äº†**åˆ†å±‚å¯é€‰çš„å›¾ç‰‡å¤„ç†æ¶æ„**ï¼Œæ”¯æŒä»é›¶ä¾èµ–çš„å ä½ç¬¦åˆ°é«˜çº§çš„ Vision LLM å¤šç§æ–¹æ¡ˆã€‚

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡æ€æƒ³

### åˆ†å±‚å¯é€‰æ¶æ„

```
ç”¨æˆ·å¯æ ¹æ®éœ€æ±‚é€‰æ‹©ä¸åŒçš„å¤„ç†ç­–ç•¥ï¼š

Level 1: å ä½ç¬¦ï¼ˆé»˜è®¤ï¼‰
   â”œâ”€â”€ é›¶ä¾èµ–
   â”œâ”€â”€ é›¶æˆæœ¬
   â””â”€â”€ å¿«é€Ÿï¼ˆæ¯«ç§’çº§ï¼‰

Level 2: OCR æ–‡å­—è¯†åˆ«
   â”œâ”€â”€ æœ¬åœ° Tesseract
   â”œâ”€â”€ å…è´¹
   â””â”€â”€ è¯†åˆ«æ–‡å­—ï¼ˆç§’çº§ï¼‰

Level 3: Vision LLM è¯­ä¹‰ç†è§£
   â”œâ”€â”€ äº‘ç«¯ API
   â”œâ”€â”€ ä»˜è´¹
   â””â”€â”€ ç†è§£è¯­ä¹‰ï¼ˆç§’çº§ï¼‰

Level 4: æ··åˆæ¨¡å¼
   â”œâ”€â”€ OCR + Vision LLM
   â”œâ”€â”€ æ™ºèƒ½é€‰æ‹©
   â””â”€â”€ æœ€ä½³æ•ˆæœ
```

---

## ğŸ“¦ å®ç°çš„ç»„ä»¶

### 1. **ç­–ç•¥æ¥å£**

**ImageContentExtractorStrategy.java**

```java
public interface ImageContentExtractorStrategy {
    String extractContent(InputStream imageStream, String imageName);
    String extractContent(File imageFile);
    String getStrategyName();
    boolean isAvailable();
}
```

### 2. **å ä½ç¬¦ç­–ç•¥ï¼ˆé»˜è®¤ï¼‰**

**PlaceholderImageStrategy.java**

```java
// é›¶ä¾èµ–ï¼Œè¿”å›å ä½ç¬¦
String result = "[å›¾ç‰‡1: example.png - æœªæå–å†…å®¹]";
```

**ç‰¹ç‚¹**:
- âœ… é›¶ä¾èµ–
- âœ… é›¶æˆæœ¬
- âœ… å§‹ç»ˆå¯ç”¨

### 3. **Tesseract OCR ç­–ç•¥**

**TesseractOCRStrategy.java**

```java
// ä½¿ç”¨ Tesseract æå–æ–‡å­—
String text = tesseract.doOCR(image);
```

**ç‰¹ç‚¹**:
- âœ… æœ¬åœ°åŒ–
- âœ… å…è´¹
- âœ… ä¸“ä¸šæ–‡å­—è¯†åˆ«
- âš ï¸ éœ€è¦é¢å¤–ä¾èµ–å’Œé…ç½®

### 4. **Vision LLM ç­–ç•¥**

**VisionLLMStrategy.java**

```java
// ä½¿ç”¨å¤šæ¨¡æ€å¤§è¯­è¨€æ¨¡å‹
String description = visionLLM.understand(image);
```

**ç‰¹ç‚¹**:
- âœ… è¯­ä¹‰ç†è§£
- âœ… æè¿°å›¾è¡¨
- âœ… æå–ç»“æ„åŒ–ä¿¡æ¯
- âš ï¸ éœ€è¦ API Key å’Œç½‘ç»œ
- âš ï¸ æœ‰è°ƒç”¨è´¹ç”¨

### 5. **æ™ºèƒ½å›¾ç‰‡æå–å™¨**

**SmartImageExtractor.java**

```java
// è‡ªåŠ¨é€‰æ‹©æœ€ä½³ç­–ç•¥
SmartImageExtractor extractor = SmartImageExtractor.fromEnv();
String content = extractor.extractContent(imageFile);
```

**ç‰¹ç‚¹**:
- âœ… è‡ªåŠ¨é€‰æ‹©å¯ç”¨ç­–ç•¥
- âœ… æ”¯æŒå¤šç§é…ç½®æ–¹å¼
- âœ… ç¯å¢ƒå˜é‡é…ç½®
- âœ… å…œåº•ä¿æŠ¤

---

## ğŸ’» ä½¿ç”¨æ–¹å¼

### æ–¹å¼1: é»˜è®¤ä½¿ç”¨ï¼ˆæ¨èï¼‰â­

```java
// ä¸éœ€è¦ä»»ä½•é…ç½®ï¼Œè‡ªåŠ¨ä½¿ç”¨å ä½ç¬¦
TikaDocumentParser parser = new TikaDocumentParser();
String content = parser.parse(new File("document.pdf"));
```

**è¾“å‡º**:
```
æ–‡æ¡£æ­£æ–‡å†…å®¹...

[å›¾ç‰‡1: chart.png - æœªæå–å†…å®¹]
```

### æ–¹å¼2: å¯ç”¨ OCR

#### æ­¥éª¤1: æ·»åŠ ä¾èµ–

```xml
<dependency>
    <groupId>net.sourceforge.tess4j</groupId>
    <artifactId>tess4j</artifactId>
    <version>5.9.0</version>
</dependency>
```

#### æ­¥éª¤2: ä¸‹è½½è¯­è¨€åŒ…

```bash
# ä¸‹è½½ä¸­æ–‡ç®€ä½“
wget https://github.com/tesseract-ocr/tessdata/raw/main/chi_sim.traineddata

# ä¸‹è½½è‹±æ–‡
wget https://github.com/tesseract-ocr/tessdata/raw/main/eng.traineddata

# æ”¾åˆ° tessdata ç›®å½•
mkdir -p ./tessdata
mv *.traineddata ./tessdata/
```

#### æ­¥éª¤3: è®¾ç½®ç¯å¢ƒå˜é‡

```bash
# Linux/Mac
export ENABLE_OCR=true
export TESSDATA_PREFIX=/path/to/tessdata

# Windows
set ENABLE_OCR=true
set TESSDATA_PREFIX=C:\path\to\tessdata
```

#### æ­¥éª¤4: ä½¿ç”¨

```java
// è‡ªåŠ¨ä»ç¯å¢ƒå˜é‡é…ç½®
TikaDocumentParser parser = new TikaDocumentParser();
String content = parser.parse(new File("document.pdf"));
```

**è¾“å‡º**:
```
æ–‡æ¡£æ­£æ–‡å†…å®¹...

é”€å”®æ•°æ®ç»Ÿè®¡è¡¨
2023å¹´ç¬¬ä¸€å­£åº¦é”€å”®é¢: 1,234,567å…ƒ
```

### æ–¹å¼3: å¯ç”¨ Vision LLM

#### æ­¥éª¤1: è®¾ç½® API Key

```bash
# Linux/Mac
export VISION_LLM_API_KEY=sk-your-api-key
export VISION_LLM_MODEL=gpt-4-vision-preview

# Windows
set VISION_LLM_API_KEY=sk-your-api-key
set VISION_LLM_MODEL=gpt-4-vision-preview
```

#### æ­¥éª¤2: ä½¿ç”¨

```java
TikaDocumentParser parser = new TikaDocumentParser();
String content = parser.parse(new File("document.pdf"));
```

**è¾“å‡º**:
```
æ–‡æ¡£æ­£æ–‡å†…å®¹...

è¿™æ˜¯ä¸€å¼ æŸ±çŠ¶å›¾ï¼Œå±•ç¤ºäº†2023å¹´å„å­£åº¦çš„é”€å”®æ•°æ®ï¼š
- ç¬¬ä¸€å­£åº¦ï¼š120ä¸‡å…ƒ
- ç¬¬äºŒå­£åº¦ï¼š150ä¸‡å…ƒ
- ç¬¬ä¸‰å­£åº¦ï¼š180ä¸‡å…ƒ
- ç¬¬å››å­£åº¦ï¼š200ä¸‡å…ƒ
æ•´ä½“å‘ˆç°ä¸Šå‡è¶‹åŠ¿ã€‚
```

### æ–¹å¼4: æ··åˆæ¨¡å¼ï¼ˆæœ€ä½³ï¼‰

```bash
# åŒæ—¶å¯ç”¨ OCR å’Œ Vision LLM
export ENABLE_OCR=true
export VISION_LLM_API_KEY=sk-your-api-key
```

**ç­–ç•¥é€‰æ‹©é€»è¾‘**:
```
1. ä¼˜å…ˆå°è¯• Vision LLMï¼ˆå¦‚æœå¯ç”¨ï¼‰
2. å…¶æ¬¡å°è¯• OCRï¼ˆå¦‚æœå¯ç”¨ï¼‰
3. å…œåº•ä½¿ç”¨å ä½ç¬¦ï¼ˆå§‹ç»ˆå¯ç”¨ï¼‰
```

---

## ğŸ”§ é«˜çº§é…ç½®

### ç¼–ç¨‹æ–¹å¼é…ç½®

```java
// æ–¹å¼1: ä½¿ç”¨ OCR
SmartImageExtractor extractor = SmartImageExtractor.withOCR();

// æ–¹å¼2: ä½¿ç”¨ Vision LLM
SmartImageExtractor extractor = SmartImageExtractor.withVisionLLM(apiKey);

// æ–¹å¼3: æ··åˆæ¨¡å¼
SmartImageExtractor extractor = SmartImageExtractor.withHybrid(apiKey);

// æ–¹å¼4: è‡ªå®šä¹‰é…ç½®
SmartImageExtractor extractor = new SmartImageExtractor();
extractor.addStrategy(new TesseractOCRStrategy(tessdataPath, "chi_sim+eng"));
extractor.addStrategy(new VisionLLMStrategy(apiKey, model, endpoint));

// ä½¿ç”¨è‡ªå®šä¹‰æå–å™¨
TikaDocumentParser parser = new TikaDocumentParser();
// parser.setImageExtractor(extractor); // å¦‚æœéœ€è¦è‡ªå®šä¹‰
```

---

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”

### æŠ€æœ¯å¯¹æ¯”

| æ–¹æ¡ˆ | é›¶ä¾èµ– | æœ¬åœ°åŒ– | æˆæœ¬ | é€Ÿåº¦ | å‡†ç¡®åº¦ | è¯­ä¹‰ç†è§£ |
|------|--------|--------|------|------|--------|---------|
| **å ä½ç¬¦** | âœ… | âœ… | å…è´¹ | å¿« | - | âŒ |
| **OCR** | âŒ | âœ… | å…è´¹ | ä¸­ | é«˜ï¼ˆæ–‡å­—ï¼‰ | âŒ |
| **Vision LLM** | âŒ | âŒ | ä»˜è´¹ | æ…¢ | é«˜ | âœ… |
| **æ··åˆæ¨¡å¼** | âŒ | âš ï¸ | ä»˜è´¹ | ä¸­ | æœ€é«˜ | âœ… |

### æˆæœ¬åˆ†æï¼ˆæ¯1000å¼ å›¾ç‰‡ï¼‰

| æ–¹æ¡ˆ | è°ƒç”¨æˆæœ¬ | åŸºç¡€è®¾æ–½æˆæœ¬ | æ€»æˆæœ¬ |
|------|---------|-------------|--------|
| å ä½ç¬¦ | $0 | $0 | **$0** |
| OCR | $0 | $0 | **$0** |
| Vision LLM | $10-50 | $0 | **$10-50** |

### é€‚ç”¨åœºæ™¯

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ |
|------|---------|
| **æ–‡æ¡£æ£€ç´¢ï¼ˆæ— éœ€å›¾ç‰‡å†…å®¹ï¼‰** | å ä½ç¬¦ â­ |
| **è¡¨æ ¼ã€å‘ç¥¨ã€èº«ä»½è¯ç­‰** | OCR â­â­â­ |
| **å›¾è¡¨ã€æµç¨‹å›¾ã€è®¾è®¡å›¾** | Vision LLM â­â­â­ |
| **æ··åˆç±»å‹æ–‡æ¡£** | æ··åˆæ¨¡å¼ â­â­â­â­â­ |

---

## ğŸ¯ ä½¿ç”¨å»ºè®®

### å»ºè®®1: æŒ‰éœ€é€‰æ‹©

```
ç®€å•åœºæ™¯ï¼ˆçº¯æ–‡æœ¬æ£€ç´¢ï¼‰
    â””â”€â”€ ä½¿ç”¨å ä½ç¬¦ï¼ˆé»˜è®¤ï¼‰

ä¸­ç­‰åœºæ™¯ï¼ˆéœ€è¦è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—ï¼‰
    â””â”€â”€ ä½¿ç”¨ OCR

é«˜çº§åœºæ™¯ï¼ˆéœ€è¦ç†è§£å›¾ç‰‡è¯­ä¹‰ï¼‰
    â””â”€â”€ ä½¿ç”¨ Vision LLM

ç”Ÿäº§ç¯å¢ƒï¼ˆæœ€ä½³æ•ˆæœï¼‰
    â””â”€â”€ ä½¿ç”¨æ··åˆæ¨¡å¼
```

### å»ºè®®2: æ¸è¿›å¼å¯ç”¨

```
é˜¶æ®µ1: å…ˆç”¨å ä½ç¬¦ä¸Šçº¿
    â””â”€â”€ éªŒè¯åŸºæœ¬åŠŸèƒ½

é˜¶æ®µ2: å¯ç”¨ OCR
    â””â”€â”€ æå‡æ–‡å­—è¯†åˆ«èƒ½åŠ›

é˜¶æ®µ3: å¯ç”¨ Vision LLM
    â””â”€â”€ å®ç°è¯­ä¹‰ç†è§£

é˜¶æ®µ4: ä¼˜åŒ–æ··åˆç­–ç•¥
    â””â”€â”€ æ ¹æ®å›¾ç‰‡ç±»å‹æ™ºèƒ½é€‰æ‹©
```

### å»ºè®®3: æˆæœ¬æ§åˆ¶

```
å¼€å‘ç¯å¢ƒ: åªç”¨å ä½ç¬¦æˆ– OCR
æµ‹è¯•ç¯å¢ƒ: ä½¿ç”¨ OCR
ç”Ÿäº§ç¯å¢ƒ: æ ¹æ®é¢„ç®—é€‰æ‹©
    â”œâ”€â”€ é¢„ç®—å……è¶³: Vision LLM
    â”œâ”€â”€ é¢„ç®—æœ‰é™: OCR
    â””â”€â”€ é›¶é¢„ç®—: å ä½ç¬¦
```

---

## ğŸ” å®ç°ç»†èŠ‚

### TikaDocumentParser é›†æˆ

```java
public class TikaDocumentParser implements DocumentParser {
    
    // æ™ºèƒ½å›¾ç‰‡æå–å™¨
    private final SmartImageExtractor imageExtractor;
    
    public TikaDocumentParser() {
        // ä»ç¯å¢ƒå˜é‡è‡ªåŠ¨é…ç½®
        this.imageExtractor = SmartImageExtractor.fromEnv();
        
        log.info("å›¾ç‰‡å¤„ç†ç­–ç•¥: {}", 
            imageExtractor.getActiveStrategy().getStrategyName());
    }
}
```

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# OCR é…ç½®
ENABLE_OCR=true                    # å¯ç”¨ OCR
TESSDATA_PREFIX=/path/to/tessdata  # Tesseract æ•°æ®è·¯å¾„
OCR_LANGUAGE=chi_sim+eng           # è¯­è¨€ï¼ˆä¸­æ–‡+è‹±æ–‡ï¼‰

# Vision LLM é…ç½®
VISION_LLM_API_KEY=sk-xxx          # API Key
VISION_LLM_MODEL=gpt-4-vision      # æ¨¡å‹åç§°
VISION_LLM_ENDPOINT=https://...    # API ç«¯ç‚¹ï¼ˆå¯é€‰ï¼‰
```

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### å¤„ç†é€Ÿåº¦

| æ–¹æ¡ˆ | å•å¼ å›¾ç‰‡è€—æ—¶ | 1000å¼ å›¾ç‰‡è€—æ—¶ |
|------|-------------|---------------|
| å ä½ç¬¦ | < 1ms | < 1s |
| OCR | 100-500ms | 2-8åˆ†é’Ÿ |
| Vision LLM | 1-3s | 15-50åˆ†é’Ÿ |

### å‡†ç¡®åº¦

| åœºæ™¯ | å ä½ç¬¦ | OCR | Vision LLM |
|------|--------|-----|-----------|
| æ‰“å°æ–‡å­— | - | 95%+ | 90%+ |
| æ‰‹å†™æ–‡å­— | - | 70%+ | 85%+ |
| å›¾è¡¨ç†è§£ | - | âŒ | 90%+ |
| è¯­ä¹‰æå– | - | âŒ | 85%+ |

---

## âœ… å®ç°æ¸…å•

- âœ… **ImageContentExtractorStrategy.java** - ç­–ç•¥æ¥å£
- âœ… **PlaceholderImageStrategy.java** - å ä½ç¬¦ç­–ç•¥ï¼ˆé»˜è®¤ï¼‰
- âœ… **TesseractOCRStrategy.java** - OCR ç­–ç•¥
- âœ… **VisionLLMStrategy.java** - Vision LLM ç­–ç•¥
- âœ… **SmartImageExtractor.java** - æ™ºèƒ½æå–å™¨
- âœ… **TikaDocumentParser é›†æˆ** - è‡ªåŠ¨é…ç½®å’Œä½¿ç”¨
- âœ… **ç¯å¢ƒå˜é‡æ”¯æŒ** - fromEnv() æ–¹æ³•
- âœ… **å¤šç§å·¥å‚æ–¹æ³•** - ä¾¿æ·åˆ›å»º
- âœ… **å®Œæ•´æ–‡æ¡£** - ä½¿ç”¨è¯´æ˜å’Œæœ€ä½³å®è·µ

---

## ğŸ‰ æ€»ç»“

### æ ¸å¿ƒä¼˜åŠ¿

1. âœ… **åˆ†å±‚å¯é€‰** - ä»é›¶ä¾èµ–åˆ°é«˜çº§ AI
2. âœ… **è‡ªåŠ¨é…ç½®** - ç¯å¢ƒå˜é‡å³å¯å¯ç”¨
3. âœ… **å…œåº•ä¿æŠ¤** - å§‹ç»ˆæœ‰å¯ç”¨æ–¹æ¡ˆ
4. âœ… **æ˜“äºæ‰©å±•** - ç­–ç•¥æ¨¡å¼ï¼Œå¯æ·»åŠ æ–°ç­–ç•¥
5. âœ… **ç¬¦åˆæ¡†æ¶å®šä½** - é»˜è®¤é›¶ä¾èµ–ï¼Œå¯é€‰å¢å¼º

### ä½¿ç”¨è·¯å¾„

```
æ–°ç”¨æˆ· â†’ ä½¿ç”¨é»˜è®¤ï¼ˆå ä½ç¬¦ï¼‰
   â†“
éœ€è¦æ–‡å­—è¯†åˆ« â†’ å¯ç”¨ OCR
   â†“
éœ€è¦è¯­ä¹‰ç†è§£ â†’ å¯ç”¨ Vision LLM
   â†“
è¿½æ±‚æœ€ä½³æ•ˆæœ â†’ ä½¿ç”¨æ··åˆæ¨¡å¼
```

**è¿™æ˜¯ä¸€ä¸ªå®Œç¾å¹³è¡¡äº†æ˜“ç”¨æ€§ã€åŠŸèƒ½æ€§å’Œçµæ´»æ€§çš„æ–¹æ¡ˆï¼** ğŸŠ

---

**å®ç°æ—¶é—´**: 2025-11-23  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… å®Œæˆå¹¶å¯ç”¨

