# âœ… Spring Boot çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿåˆ›å»ºå®Œæˆ

## ğŸ¯ åˆ›å»ºçš„æ–‡ä»¶

### 1. æ ¸å¿ƒä»£ç ï¼ˆ7ä¸ªæ–‡ä»¶ï¼‰

```
src/main/java/top/yumbo/ai/rag/example/application/
â”œâ”€â”€ KnowledgeQASystemApplication.java          # ä¸»åº”ç”¨ç±»
â”œâ”€â”€ config/
â”‚   â””â”€â”€ KnowledgeQAProperties.java             # é…ç½®å±æ€§ç±»
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ KnowledgeQAService.java                # é—®ç­”æœåŠ¡
â”‚   â”œâ”€â”€ KnowledgeBaseService.java              # çŸ¥è¯†åº“æ„å»ºæœåŠ¡
â”‚   â””â”€â”€ ModelCheckService.java                 # æ¨¡å‹æ£€æŸ¥æœåŠ¡
â””â”€â”€ controller/
    â””â”€â”€ KnowledgeQAController.java             # REST API æ§åˆ¶å™¨
```

### 2. é…ç½®æ–‡ä»¶

```
src/main/resources/
â””â”€â”€ application.yml                             # åº”ç”¨é…ç½®æ–‡ä»¶
```

### 3. æ–‡æ¡£

```
README-KnowledgeQASystem.md                     # é¡¹ç›®è¯´æ˜
md/æœ¬åœ°æ–‡ä»¶RAG/*_çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿä½¿ç”¨æŒ‡å—.md      # è¯¦ç»†ä½¿ç”¨æŒ‡å—
```

---

## âœ¨ ä¸»è¦åŠŸèƒ½

### 1. **å¤šæ ¼å¼æ”¯æŒ**

æ”¯æŒä»¥ä¸‹æ–‡ä»¶æ ¼å¼ï¼š
- **Excel**: .xlsx, .xls
- **Word**: .docx, .doc
- **PowerPoint**: .pptx, .ppt
- **PDF**: .pdf
- **æ–‡æœ¬**: .txt, .md, .html, .xml

**é…ç½®æ–¹å¼**:
```yaml
knowledge:
  qa:
    document:
      supported-formats:
        - xlsx
        - xls
        - docx
        - pptx
        - pdf
        - txt
```

### 2. **æ¨¡å‹è‡ªåŠ¨æ£€æµ‹**

å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥æ¨¡å‹æ–‡ä»¶ï¼ŒæŒ‰ä¼˜å…ˆçº§æŸ¥æ‰¾ï¼š

1. BGE-M3 (2024æœ€æ–°)
2. Multilingual-E5-Large
3. BGE-Large-ZH
4. Paraphrase-Multilingual
5. Text2Vec-Base-Chinese

**ç‰¹ç‚¹**:
- âœ… è‡ªåŠ¨æŸ¥æ‰¾å¤šä¸ªç›®å½•
- âœ… æ”¯æŒå¤šç§æ¨¡å‹æ–‡ä»¶å
- âœ… æœªæ‰¾åˆ°æ¨¡å‹æ—¶ç»™å‡ºè¯¦ç»†æç¤º
- âœ… æä¾›ä¸‹è½½è¯´æ˜

**é…ç½®æ–¹å¼**:
```yaml
knowledge:
  qa:
    vector-search:
      model:
        search-paths:
          - bge-m3                    # ä¼˜å…ˆçº§æœ€é«˜
          - multilingual-e5-large
          - paraphrase-multilingual
```

### 3. **çµæ´»çš„é…ç½®ç®¡ç†**

é€šè¿‡ `application.yml` é…ç½®æ‰€æœ‰å‚æ•°ï¼š

#### çŸ¥è¯†åº“é…ç½®
```yaml
knowledge:
  qa:
    knowledge-base:
      storage-path: ./data/knowledge-base     # å­˜å‚¨è·¯å¾„
      source-path: ./data/documents           # æ–‡æ¡£è·¯å¾„
      rebuild-on-startup: false               # æ˜¯å¦é‡å»º
```

#### å‘é‡æ£€ç´¢é…ç½®
```yaml
knowledge:
  qa:
    vector-search:
      enabled: true                           # å¯ç”¨/ç¦ç”¨
      similarity-threshold: 0.4               # ç›¸ä¼¼åº¦é˜ˆå€¼
      top-k: 20                               # è¿”å›æ•°é‡
```

#### æ–‡æ¡£å¤„ç†é…ç½®
```yaml
knowledge:
  qa:
    document:
      max-file-size-mb: 200                   # æœ€å¤§æ–‡ä»¶å¤§å°
      chunk-size: 2000                        # åˆ†å—å¤§å°
      chunk-overlap: 400                      # åˆ†å—é‡å 
```

### 4. **REST API**

æä¾›æ ‡å‡†çš„ HTTP æ¥å£ï¼š

#### é—®ç­”æ¥å£
```bash
POST /api/qa/ask
{
  "question": "ä½ çš„é—®é¢˜"
}
```

#### æœç´¢æ¥å£
```bash
GET /api/qa/search?query=å…³é”®è¯&limit=10
```

#### ç»Ÿè®¡æ¥å£
```bash
GET /api/qa/statistics
```

#### å¥åº·æ£€æŸ¥
```bash
GET /api/qa/health
```

---

## ğŸ”§ ä¸ ExcelKnowledgeQASystem çš„å¯¹æ¯”

| ç‰¹æ€§ | ExcelKnowledgeQASystem | KnowledgeQASystemApplication |
|------|------------------------|------------------------------|
| **æ¡†æ¶** | çº¯ Java | âœ… Spring Boot |
| **æ–‡ä»¶æ ¼å¼** | ä»… Excel | âœ… Excel, Word, PPT, PDF, TXTç­‰ |
| **é…ç½®** | ç¡¬ç¼–ç  | âœ… application.yml |
| **æ¨¡å‹æ£€æŸ¥** | æ—  | âœ… å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥ |
| **REST API** | æ—  | âœ… å®Œæ•´çš„ REST API |
| **éƒ¨ç½²** | å‘½ä»¤è¡Œå·¥å…· | âœ… Web åº”ç”¨ |
| **æ—¥å¿—** | System.out | âœ… SLF4J + Logback |
| **ä¾èµ–æ³¨å…¥** | æ‰‹åŠ¨ | âœ… Spring IoC |
| **ç”Ÿå‘½å‘¨æœŸç®¡ç†** | æ‰‹åŠ¨ | âœ… Spring è‡ªåŠ¨ç®¡ç† |

---

## ğŸ“‹ ä¸‹ä¸€æ­¥éœ€è¦åšçš„äº‹

### 1. æ·»åŠ  Spring Boot ä¾èµ–

éœ€è¦åœ¨ `pom.xml` ä¸­æ·»åŠ ï¼š

```xml
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>2.7.18</version>
</parent>

<dependencies>
    <!-- Spring Boot Web -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>

    <!-- Spring Boot Configuration Processor -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-configuration-processor</artifactId>
        <optional>true</optional>
    </dependency>

    <!-- Lombok -->
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <optional>true</optional>
    </dependency>
</dependencies>
```

### 2. ä¸‹è½½æ¨¡å‹æ–‡ä»¶

```bash
pip install optimum[onnxruntime] transformers

python -c "
from optimum.onnxruntime import ORTModelForFeatureExtraction
from transformers import AutoTokenizer

model = ORTModelForFeatureExtraction.from_pretrained('BAAI/bge-m3', export=True)
tokenizer = AutoTokenizer.from_pretrained('BAAI/bge-m3')

model.save_pretrained('src/main/resources/models/bge-m3')
tokenizer.save_pretrained('src/main/resources/models/bge-m3')
"
```

### 3. å‡†å¤‡æµ‹è¯•æ–‡æ¡£

```bash
mkdir -p ./data/documents
# å°†æµ‹è¯•æ–‡æ¡£æ”¾åˆ°è¿™ä¸ªç›®å½•
```

### 4. å¯åŠ¨åº”ç”¨

```bash
mvn spring-boot:run
```

---

## ğŸ¨ ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯ 1: å¯åŠ¨åº”ç”¨ï¼ˆé¦–æ¬¡ï¼‰

```bash
# 1. é…ç½®
vi src/main/resources/application.yml
# ä¿®æ”¹ source-path å’Œ rebuild-on-startup: true

# 2. å¯åŠ¨
mvn spring-boot:run

# è¾“å‡ºï¼š
=================================================================
ğŸ“š çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿåˆå§‹åŒ–ä¸­...
=================================================================
ğŸ” æ£€æŸ¥å‘é‡åµŒå…¥æ¨¡å‹...
âœ… æ‰¾åˆ°æ¨¡å‹: /models/bge-m3/model.onnx
ğŸ”¨ æ­¥éª¤1: åˆå§‹åŒ–çŸ¥è¯†åº“
ğŸ“‚ æ‰«ææ–‡æ¡£: ./data/documents
âœ… æ‰¾åˆ° 50 ä¸ªæ–‡æ¡£æ–‡ä»¶
ğŸ“ å¼€å§‹å¤„ç†æ–‡æ¡£...
ğŸ“„ å¤„ç†: file1.xlsx (120 KB)
   âœ“ æå– 15000 å­—ç¬¦
   âœ“ åˆ†å—: 8 ä¸ª
   âœ… ç´¢å¼•å®Œæˆ
...
âœ… çŸ¥è¯†åº“æ„å»ºå®Œæˆ
=================================================================
```

### åœºæ™¯ 2: ä½¿ç”¨ API

```bash
# é—®ç­”
curl -X POST http://localhost:8080/api/qa/ask \
  -H "Content-Type: application/json" \
  -d '{"question": "è´¢åŠ¡ç®¡ç†ä¸“ä¸šçš„åˆ†æ•°çº¿"}'

# å“åº”
{
  "question": "è´¢åŠ¡ç®¡ç†ä¸“ä¸šçš„åˆ†æ•°çº¿",
  "answer": "æ ¹æ®æ£€ç´¢åˆ°çš„æ•°æ®ï¼Œè´¢åŠ¡ç®¡ç†ä¸“ä¸šçš„åˆ†æ•°çº¿å¦‚ä¸‹...",
  "sources": ["æ‹›ç”Ÿç®€ç« .xlsx", "å†å¹´åˆ†æ•°.docx"],
  "responseTimeMs": 1234
}
```

### åœºæ™¯ 3: åç»­å¯åŠ¨ï¼ˆä½¿ç”¨å·²æœ‰çŸ¥è¯†åº“ï¼‰

```bash
# ä¿®æ”¹é…ç½®
rebuild-on-startup: false

# å¯åŠ¨
mvn spring-boot:run

# è¾“å‡ºï¼š
ğŸ“š æ£€æµ‹åˆ°å·²æœ‰çŸ¥è¯†åº“ (500 ä¸ªæ–‡æ¡£)
âœ… è·³è¿‡æ„å»ºï¼Œä½¿ç”¨å·²æœ‰çŸ¥è¯†åº“
âœ… çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼
```

---

## ğŸ’¡ å…³é”®è®¾è®¡ç‚¹

### 1. **æœåŠ¡åˆ†å±‚**

```
Controller (APIå±‚)
    â†“
Service (ä¸šåŠ¡å±‚)
    â”œâ”€â”€ KnowledgeQAService      # é—®ç­”æœåŠ¡
    â”œâ”€â”€ KnowledgeBaseService    # çŸ¥è¯†åº“æ„å»º
    â””â”€â”€ ModelCheckService       # æ¨¡å‹æ£€æŸ¥
    â†“
Core (æ ¸å¿ƒå±‚)
    â”œâ”€â”€ LocalFileRAG            # RAG å¼•æ“
    â”œâ”€â”€ LocalEmbeddingEngine    # å‘é‡åµŒå…¥
    â””â”€â”€ TikaDocumentParser      # æ–‡æ¡£è§£æ
```

### 2. **é…ç½®ç®¡ç†**

ä½¿ç”¨ `@ConfigurationProperties` å®ç°ç±»å‹å®‰å…¨çš„é…ç½®ï¼š

```java
@ConfigurationProperties(prefix = "knowledge.qa")
public class KnowledgeQAProperties {
    private KnowledgeBaseConfig knowledgeBase;
    private VectorSearchConfig vectorSearch;
    // ...
}
```

### 3. **ç”Ÿå‘½å‘¨æœŸç®¡ç†**

- `@PostConstruct`: åˆå§‹åŒ–
- `@PreDestroy`: æ¸…ç†èµ„æº
- `@EventListener`: å¯åŠ¨æ£€æŸ¥

### 4. **æ¨¡å‹è‡ªåŠ¨æŸ¥æ‰¾**

```java
// æŒ‰ä¼˜å…ˆçº§æŸ¥æ‰¾
for (String modelDir : searchPaths) {
    for (String fileName : fileNames) {
        // 1. resources
        // 2. æ–‡ä»¶ç³»ç»Ÿ
        // 3. ç»å¯¹è·¯å¾„
    }
}
```

---

## ğŸ“š æ‰©å±•å»ºè®®

### 1. æ·»åŠ ç”¨æˆ·è®¤è¯

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    // ...
}
```

### 2. æ·»åŠ  Web UI

```
src/main/resources/static/
â”œâ”€â”€ index.html
â”œâ”€â”€ css/
â””â”€â”€ js/
```

### 3. æ”¯æŒå¤šç§Ÿæˆ·

```yaml
knowledge:
  qa:
    multi-tenant:
      enabled: true
      default-tenant: default
```

### 4. æ·»åŠ ç›‘æ§

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

---

## âœ… æ€»ç»“

### å®Œæˆçš„åŠŸèƒ½

âœ… **Spring Boot åº”ç”¨**: å®Œæ•´çš„ä¼ä¸šçº§æ¡†æ¶  
âœ… **å¤šæ ¼å¼æ”¯æŒ**: Excel, Word, PowerPoint, PDF, TXTç­‰  
âœ… **é…ç½®åŒ–ç®¡ç†**: application.yml é…ç½®æ‰€æœ‰å‚æ•°  
âœ… **æ¨¡å‹è‡ªåŠ¨æ£€æµ‹**: å¯åŠ¨æ—¶æ£€æŸ¥å¹¶ç»™å‡ºæç¤º  
âœ… **REST API**: æ ‡å‡†çš„ HTTP æ¥å£  
âœ… **æœåŠ¡åˆ†å±‚**: æ¸…æ™°çš„æ¶æ„è®¾è®¡  
âœ… **ç”Ÿå‘½å‘¨æœŸç®¡ç†**: Spring è‡ªåŠ¨ç®¡ç†èµ„æº

### ä¼˜åŠ¿

- ğŸš€ **æ˜“äºéƒ¨ç½²**: æ ‡å‡†çš„ Spring Boot åº”ç”¨
- ğŸ”§ **çµæ´»é…ç½®**: æ‰€æœ‰å‚æ•°éƒ½å¯é…ç½®
- ğŸ“¦ **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½
- ğŸŒ **Web å‹å¥½**: æä¾› REST API
- ğŸ“Š **ç”Ÿäº§å°±ç»ª**: ä¼ä¸šçº§æ¡†æ¶

### ä¸‹ä¸€æ­¥

1. æ·»åŠ  Spring Boot ä¾èµ–åˆ° pom.xml
2. ä¸‹è½½æ¨¡å‹æ–‡ä»¶
3. å‡†å¤‡æµ‹è¯•æ–‡æ¡£
4. å¯åŠ¨åº”ç”¨æµ‹è¯•

**ç°åœ¨ä½ æœ‰äº†ä¸€ä¸ªå®Œæ•´çš„ã€ç”Ÿäº§çº§çš„çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿï¼** ğŸ‰

