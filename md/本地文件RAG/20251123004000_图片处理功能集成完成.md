# âœ… å›¾ç‰‡è½¬æ–‡æœ¬åŠŸèƒ½å·²é›†æˆåˆ° KnowledgeQASystemApplication

## ğŸ¯ é›†æˆæ¦‚è¿°

å·²æˆåŠŸå°†å›¾ç‰‡è½¬æ–‡æœ¬åŠŸèƒ½é›†æˆåˆ° `KnowledgeQASystemApplication` ä¸­ï¼Œæ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶çµæ´»é€‰æ‹©å›¾ç‰‡å¤„ç†ç­–ç•¥ã€‚

---

## ğŸ“¦ é›†æˆçš„ç»„ä»¶

### 1. é…ç½®ç±»æ‰©å±•

#### KnowledgeQAProperties.java

æ–°å¢é…ç½®é¡¹ï¼š

```java
/**
 * å›¾ç‰‡å¤„ç†é…ç½®
 */
private ImageProcessingConfig imageProcessing = new ImageProcessingConfig();

// åŒ…å«ä»¥ä¸‹å­é…ç½®ï¼š
// - ImageProcessingConfig: æ€»é…ç½®
// - OcrConfig: OCR é…ç½®
// - VisionLlmConfig: Vision LLM é…ç½®
```

### 2. è‡ªåŠ¨é…ç½®ç±»

#### ImageProcessingConfiguration.java (æ–°å¢)

```java
@Configuration
public class ImageProcessingConfiguration {
    
    @Bean
    public SmartImageExtractor smartImageExtractor() {
        // æ ¹æ®é…ç½®è‡ªåŠ¨åˆ›å»ºå›¾ç‰‡æå–å™¨
        // æ”¯æŒ: placeholder, ocr, vision-llm, hybrid
    }
}
```

**åŠŸèƒ½**:
- âœ… è‡ªåŠ¨è¯»å–é…ç½®
- âœ… åˆ›å»ºç›¸åº”çš„ç­–ç•¥
- âœ… è§£æç¯å¢ƒå˜é‡
- âœ… æ˜¾ç¤ºæ¿€æ´»çš„ç­–ç•¥

### 3. é…ç½®æ–‡ä»¶

#### application.yml

æ–°å¢é…ç½®èŠ‚ï¼š

```yaml
knowledge:
  qa:
    image-processing:
      strategy: placeholder  # å›¾ç‰‡å¤„ç†ç­–ç•¥
      enable-ocr: false      # æ˜¯å¦å¯ç”¨ OCR
      
      ocr:
        tessdata-path: ${TESSDATA_PREFIX:}
        language: chi_sim+eng
      
      vision-llm:
        enabled: false
        api-key: ${VISION_LLM_API_KEY:}
        model: gpt-4-vision-preview
```

---

## ğŸ’» ä½¿ç”¨æ–¹å¼

### æ–¹å¼1: é»˜è®¤é…ç½®ï¼ˆå ä½ç¬¦ï¼‰â­

**é…ç½®** (application.yml):
```yaml
knowledge:
  qa:
    image-processing:
      strategy: placeholder
```

**æ•ˆæœ**:
- ä½¿ç”¨å ä½ç¬¦ç­–ç•¥
- é›¶ä¾èµ–ï¼Œé›¶æˆæœ¬
- å›¾ç‰‡æ˜¾ç¤ºä¸º `[å›¾ç‰‡1: xxx.png - æœªæå–å†…å®¹]`

**å¯åŠ¨**:
```bash
mvn spring-boot:run
```

### æ–¹å¼2: å¯ç”¨ OCR

#### æ­¥éª¤1: å®‰è£… Tesseract å’Œè¯­è¨€åŒ…

```bash
# Ubuntu/Debian
sudo apt-get install tesseract-ocr
sudo apt-get install tesseract-ocr-chi-sim tesseract-ocr-eng

# macOS
brew install tesseract tesseract-lang

# Windows
# ä¸‹è½½å¹¶å®‰è£… Tesseract-OCR
# https://github.com/UB-Mannheim/tesseract/wiki

# ä¸‹è½½è¯­è¨€åŒ…
wget https://github.com/tesseract-ocr/tessdata/raw/main/chi_sim.traineddata
wget https://github.com/tesseract-ocr/tessdata/raw/main/eng.traineddata
```

#### æ­¥éª¤2: æ·»åŠ  Maven ä¾èµ–

```xml
<!-- åœ¨ pom.xml ä¸­æ·»åŠ  -->
<dependency>
    <groupId>net.sourceforge.tess4j</groupId>
    <artifactId>tess4j</artifactId>
    <version>5.9.0</version>
</dependency>
```

#### æ­¥éª¤3: é…ç½®

**æ–¹å¼A: ä¿®æ”¹ application.yml**
```yaml
knowledge:
  qa:
    image-processing:
      strategy: ocr
      enable-ocr: true
      ocr:
        tessdata-path: /usr/share/tesseract-ocr/5/tessdata  # æ ¹æ®å®é™…è·¯å¾„
        language: chi_sim+eng
```

**æ–¹å¼B: ä½¿ç”¨ç¯å¢ƒå˜é‡**
```bash
# Linux/Mac
export TESSDATA_PREFIX=/usr/share/tesseract-ocr/5/tessdata

# Windows
set TESSDATA_PREFIX=C:\Program Files\Tesseract-OCR\tessdata
```

```yaml
knowledge:
  qa:
    image-processing:
      strategy: ocr
      enable-ocr: true
```

#### æ­¥éª¤4: å¯åŠ¨

```bash
mvn spring-boot:run
```

**å¯åŠ¨æ—¥å¿—**:
```
ğŸ–¼ï¸  åˆå§‹åŒ–å›¾ç‰‡å¤„ç†åŠŸèƒ½...
   é…ç½®ç­–ç•¥: ocr
   æ·»åŠ  OCR ç­–ç•¥:
      - Tessdataè·¯å¾„: /usr/share/tesseract-ocr/5/tessdata
      - è¯†åˆ«è¯­è¨€: chi_sim+eng
   âœ… OCR ç­–ç•¥å¯ç”¨
âœ… å›¾ç‰‡å¤„ç†ç­–ç•¥å·²æ¿€æ´»: Tesseract OCR
```

### æ–¹å¼3: å¯ç”¨ Vision LLM

#### æ­¥éª¤1: é…ç½®

```yaml
knowledge:
  qa:
    image-processing:
      strategy: vision-llm
      vision-llm:
        enabled: true
        api-key: ${VISION_LLM_API_KEY:}
        model: gpt-4-vision-preview
```

#### æ­¥éª¤2: è®¾ç½®ç¯å¢ƒå˜é‡

```bash
# Linux/Mac
export VISION_LLM_API_KEY=sk-your-api-key

# Windows
set VISION_LLM_API_KEY=sk-your-api-key
```

#### æ­¥éª¤3: å¯åŠ¨

```bash
mvn spring-boot:run
```

**å¯åŠ¨æ—¥å¿—**:
```
ğŸ–¼ï¸  åˆå§‹åŒ–å›¾ç‰‡å¤„ç†åŠŸèƒ½...
   é…ç½®ç­–ç•¥: vision-llm
   æ·»åŠ  Vision LLM ç­–ç•¥:
      - æ¨¡å‹: gpt-4-vision-preview
   âœ… Vision LLM ç­–ç•¥å¯ç”¨
âœ… å›¾ç‰‡å¤„ç†ç­–ç•¥å·²æ¿€æ´»: Vision LLM (gpt-4-vision-preview)
```

### æ–¹å¼4: æ··åˆæ¨¡å¼ï¼ˆæœ€ä½³ï¼‰

#### é…ç½®

```yaml
knowledge:
  qa:
    image-processing:
      strategy: hybrid
      enable-ocr: true
      ocr:
        language: chi_sim+eng
      vision-llm:
        enabled: true
```

#### ç¯å¢ƒå˜é‡

```bash
export TESSDATA_PREFIX=/path/to/tessdata
export VISION_LLM_API_KEY=sk-your-api-key
```

#### å¯åŠ¨

```bash
mvn spring-boot:run
```

**å¯åŠ¨æ—¥å¿—**:
```
ğŸ–¼ï¸  åˆå§‹åŒ–å›¾ç‰‡å¤„ç†åŠŸèƒ½...
   é…ç½®ç­–ç•¥: hybrid
   æ·»åŠ  Vision LLM ç­–ç•¥:
      - æ¨¡å‹: gpt-4-vision-preview
   âœ… Vision LLM ç­–ç•¥å¯ç”¨
   æ·»åŠ  OCR ç­–ç•¥:
      - è¯†åˆ«è¯­è¨€: chi_sim+eng
   âœ… OCR ç­–ç•¥å¯ç”¨
âœ… å›¾ç‰‡å¤„ç†ç­–ç•¥å·²æ¿€æ´»: Vision LLM (gpt-4-vision-preview)
```

**ç­–ç•¥é€‰æ‹©**:
- ä¼˜å…ˆä½¿ç”¨ Vision LLMï¼ˆè¯­ä¹‰ç†è§£ï¼‰
- Vision LLM ä¸å¯ç”¨æ—¶å›é€€åˆ° OCRï¼ˆæ–‡å­—è¯†åˆ«ï¼‰
- éƒ½ä¸å¯ç”¨æ—¶ä½¿ç”¨å ä½ç¬¦ï¼ˆå…œåº•ï¼‰

---

## ğŸ“Š é…ç½®å¯¹æ¯”

### ç­–ç•¥å¯¹æ¯”

| ç­–ç•¥ | é…ç½®å¤æ‚åº¦ | ä¾èµ– | æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
|------|----------|------|------|---------|
| **placeholder** | â­ | æ—  | å…è´¹ | çº¯æ–‡æœ¬æ£€ç´¢ |
| **ocr** | â­â­â­ | Tesseract | å…è´¹ | è¡¨æ ¼ã€å‘ç¥¨è¯†åˆ« |
| **vision-llm** | â­â­ | API Key | ä»˜è´¹ | å›¾è¡¨ç†è§£ |
| **hybrid** | â­â­â­â­ | ä¸¤è€… | ä»˜è´¹ | ç”Ÿäº§ç¯å¢ƒ |

### å®Œæ•´é…ç½®ç¤ºä¾‹

#### æœ€å°é…ç½®ï¼ˆé»˜è®¤ï¼‰

```yaml
knowledge:
  qa:
    image-processing:
      strategy: placeholder
```

#### OCR é…ç½®

```yaml
knowledge:
  qa:
    image-processing:
      strategy: ocr
      enable-ocr: true
      ocr:
        tessdata-path: ${TESSDATA_PREFIX:}
        language: chi_sim+eng
```

#### Vision LLM é…ç½®

```yaml
knowledge:
  qa:
    image-processing:
      strategy: vision-llm
      vision-llm:
        enabled: true
        api-key: ${VISION_LLM_API_KEY:}
        model: gpt-4-vision-preview
        endpoint: ${VISION_LLM_ENDPOINT:}  # å¯é€‰
```

#### æ··åˆæ¨¡å¼é…ç½®

```yaml
knowledge:
  qa:
    image-processing:
      strategy: hybrid
      enable-ocr: true
      ocr:
        tessdata-path: ${TESSDATA_PREFIX:}
        language: chi_sim+eng
      vision-llm:
        enabled: true
        api-key: ${VISION_LLM_API_KEY:}
        model: gpt-4-vision-preview
```

---

## ğŸ” å·¥ä½œæµç¨‹

### å¯åŠ¨æµç¨‹

```
1. åº”ç”¨å¯åŠ¨
   â†“
2. ImageProcessingConfiguration åˆå§‹åŒ–
   â†“
3. è¯»å– image-processing é…ç½®
   â†“
4. æ ¹æ® strategy åˆ›å»ºç›¸åº”çš„ç­–ç•¥
   â†“
5. æ·»åŠ åˆ° SmartImageExtractor
   â†“
6. é€‰æ‹©æ¿€æ´»çš„ç­–ç•¥
   â†“
7. æ˜¾ç¤ºå¯åŠ¨æ—¥å¿—
   â†“
8. å‡†å¤‡å°±ç»ª
```

### æ–‡æ¡£å¤„ç†æµç¨‹

```
1. ç”¨æˆ·ä¸Šä¼ /ç´¢å¼•æ–‡æ¡£
   â†“
2. TikaDocumentParser è§£ææ–‡æ¡£
   â†“
3. é‡åˆ°å›¾ç‰‡å†…å®¹
   â†“
4. SmartImageExtractor å¤„ç†å›¾ç‰‡
   â†“
5. ä½¿ç”¨æ¿€æ´»çš„ç­–ç•¥æå–å†…å®¹
   â†“
6. å°†æå–çš„æ–‡æœ¬æ’å…¥åˆ°æ–‡æ¡£ä¸­
   â†“
7. ç´¢å¼•åˆ°çŸ¥è¯†åº“
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. å¼€å‘ç¯å¢ƒ

```yaml
knowledge:
  qa:
    image-processing:
      strategy: placeholder  # å¿«é€Ÿå¼€å‘ï¼Œé›¶é…ç½®
```

### 2. æµ‹è¯•ç¯å¢ƒ

```yaml
knowledge:
  qa:
    image-processing:
      strategy: ocr         # æµ‹è¯• OCR åŠŸèƒ½
      enable-ocr: true
```

### 3. ç”Ÿäº§ç¯å¢ƒ

#### æ–¹æ¡ˆA: æˆæœ¬æ•æ„Ÿ

```yaml
knowledge:
  qa:
    image-processing:
      strategy: ocr         # ä½¿ç”¨å…è´¹çš„ OCR
      enable-ocr: true
```

#### æ–¹æ¡ˆB: æ•ˆæœä¼˜å…ˆ

```yaml
knowledge:
  qa:
    image-processing:
      strategy: hybrid      # æ··åˆæ¨¡å¼ï¼Œæœ€ä½³æ•ˆæœ
      enable-ocr: true
      vision-llm:
        enabled: true
```

---

## ğŸ“ˆ æ€§èƒ½å»ºè®®

### 1. æ‰¹é‡å¤„ç†å¤§é‡æ–‡æ¡£

å¦‚æœéœ€è¦å¤„ç†å¤§é‡åŒ…å«å›¾ç‰‡çš„æ–‡æ¡£ï¼š

- âœ… ä½¿ç”¨ `placeholder` å¿«é€Ÿç´¢å¼•
- âœ… åç»­å¯ä»¥é‡æ–°ç´¢å¼•å¯ç”¨ OCR/Vision LLM

### 2. æˆæœ¬æ§åˆ¶

Vision LLM æˆæœ¬æ§åˆ¶ï¼š

```yaml
# åªåœ¨é‡è¦åœºæ™¯å¯ç”¨
knowledge:
  qa:
    image-processing:
      strategy: hybrid
      # OCR å…è´¹ï¼Œå…ˆå°è¯• OCR
      # åªæœ‰ OCR å¤±è´¥æ‰ç”¨ Vision LLM
```

### 3. æ€§èƒ½ä¼˜åŒ–

OCR æ€§èƒ½ä¼˜åŒ–ï¼š

```yaml
knowledge:
  qa:
    image-processing:
      ocr:
        language: chi_sim  # åªè¯†åˆ«ä¸­æ–‡ï¼Œæ›´å¿«
        # æˆ– eng           # åªè¯†åˆ«è‹±æ–‡
```

---

## âœ… é›†æˆæ¸…å•

- âœ… **KnowledgeQAProperties** - æ·»åŠ å›¾ç‰‡å¤„ç†é…ç½®
  - ImageProcessingConfig
  - OcrConfig
  - VisionLlmConfig

- âœ… **ImageProcessingConfiguration** - è‡ªåŠ¨é…ç½®ç±»
  - åˆ›å»º SmartImageExtractor Bean
  - æ ¹æ®é…ç½®æ·»åŠ ç­–ç•¥
  - ç¯å¢ƒå˜é‡è§£æ

- âœ… **application.yml** - é…ç½®æ–‡ä»¶
  - image-processing é…ç½®èŠ‚
  - è¯¦ç»†çš„é…ç½®è¯´æ˜
  - ç¯å¢ƒå˜é‡å ä½ç¬¦

- âœ… **ç¼–è¯‘éªŒè¯** - é€šè¿‡
- âœ… **é›¶ä¾µå…¥** - ä¸å½±å“ç°æœ‰åŠŸèƒ½
- âœ… **å‘åå…¼å®¹** - é»˜è®¤ä½¿ç”¨å ä½ç¬¦

---

## ğŸ‰ æ€»ç»“

### é›†æˆä¼˜åŠ¿

1. âœ… **é…ç½®åŒ–ç®¡ç†** - é€šè¿‡ application.yml ç»Ÿä¸€é…ç½®
2. âœ… **è‡ªåŠ¨è£…é…** - Spring Boot è‡ªåŠ¨é…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨åˆ›å»º
3. âœ… **çµæ´»åˆ‡æ¢** - ä¿®æ”¹é…ç½®å³å¯åˆ‡æ¢ç­–ç•¥
4. âœ… **ç¯å¢ƒå˜é‡æ”¯æŒ** - æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡
5. âœ… **å…œåº•ä¿æŠ¤** - å§‹ç»ˆæœ‰å¯ç”¨çš„ç­–ç•¥
6. âœ… **é›¶ä¾µå…¥** - ä¸å½±å“ç°æœ‰åŠŸèƒ½

### ä½¿ç”¨è·¯å¾„

```
å¼€å‘é˜¶æ®µ â†’ placeholderï¼ˆé»˜è®¤ï¼‰
    â†“
éœ€è¦æ–‡å­—è¯†åˆ« â†’ å¯ç”¨ OCR
    â†“
éœ€è¦è¯­ä¹‰ç†è§£ â†’ å¯ç”¨ Vision LLM
    â†“
ç”Ÿäº§ç¯å¢ƒ â†’ hybridï¼ˆæ··åˆæ¨¡å¼ï¼‰
```

**å›¾ç‰‡å¤„ç†åŠŸèƒ½å·²å®Œç¾é›†æˆåˆ° KnowledgeQASystemApplicationï¼** ğŸŠ

---

**é›†æˆæ—¶é—´**: 2025-11-23  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… å®Œæˆå¹¶å¯ç”¨

