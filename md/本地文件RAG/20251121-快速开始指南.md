# Local File RAG - å¿«é€Ÿå¼€å§‹æŒ‡å—

**ç‰ˆæœ¬**: 1.0.0-SNAPSHOT  
**æ›´æ–°æ—¥æœŸ**: 2025-11-21  
**é€‚ç”¨é˜¶æ®µ**: ç¬¬1-2é˜¶æ®µåŠŸèƒ½

---

## ğŸ“¦ ç¯å¢ƒè¦æ±‚

- **Java**: 17 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Maven**: 3.9 æˆ–æ›´é«˜ç‰ˆæœ¬
- **å†…å­˜**: å»ºè®® 4GB+
- **ç£ç›˜**: å»ºè®® 10GB+ å¯ç”¨ç©ºé—´

---

## ğŸš€ å¿«é€Ÿå®‰è£…

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/yourorg/local-file-rag.git
cd local-file-rag
```

### 2. ç¼–è¯‘é¡¹ç›®

```bash
mvn clean install
```

### 3. è¿è¡Œæµ‹è¯•

```bash
mvn test
```

---

## ğŸ’¡ åŸºç¡€ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå­˜å‚¨å’Œæ£€ç´¢æ–‡æ¡£

```java
import com.framework.core.model.Document;
import com.framework.core.storage.StorageEngine;
import com.framework.core.storage.impl.*;

public class BasicStorageExample {
    public static void main(String[] args) {
        // 1. åˆå§‹åŒ–ç»„ä»¶
        DocumentHasher hasher = new SHA256DocumentHasher();
        MetadataManager metadataManager = new SQLiteMetadataManager("./data/metadata.db");
        StorageEngine storage = new FileSystemStorageEngine("./data", hasher, metadataManager);
        
        // 2. åˆ›å»ºæ–‡æ¡£
        Document doc = Document.builder()
            .title("Javaç¼–ç¨‹æŒ‡å—")
            .content("è¿™æ˜¯ä¸€ä»½Javaç¼–ç¨‹å…¥é—¨æŒ‡å—ï¼Œä»‹ç»äº†Javaçš„åŸºç¡€è¯­æ³•...")
            .addMetadata("author", "å¼ ä¸‰")
            .addMetadata("category", "æŠ€æœ¯")
            .build();
        
        // 3. å­˜å‚¨æ–‡æ¡£
        String docId = storage.store(doc);
        System.out.println("æ–‡æ¡£å·²å­˜å‚¨ï¼ŒID: " + docId);
        
        // 4. æ£€ç´¢æ–‡æ¡£
        Optional<Document> retrieved = storage.retrieve(docId);
        if (retrieved.isPresent()) {
            System.out.println("æ£€ç´¢åˆ°æ–‡æ¡£: " + retrieved.get().getTitle());
        }
        
        // 5. ç»Ÿè®¡ä¿¡æ¯
        System.out.println("æ–‡æ¡£æ€»æ•°: " + storage.count());
    }
}
```

### ç¤ºä¾‹2ï¼šç´¢å¼•å’Œæœç´¢æ–‡æ¡£

```java
import com.framework.core.index.IndexEngine;
import com.framework.core.index.SearchResult;
import com.framework.core.index.impl.LuceneIndexEngine;
import com.framework.core.model.Document;

public class BasicIndexExample {
    public static void main(String[] args) throws IOException {
        // 1. åˆå§‹åŒ–ç´¢å¼•å¼•æ“
        IndexEngine indexEngine = new LuceneIndexEngine("./data/index");
        
        // 2. åˆ›å»ºå¹¶ç´¢å¼•æ–‡æ¡£
        Document doc1 = Document.builder()
            .id("1")
            .title("Pythonæ•°æ®åˆ†æ")
            .content("Pythonåœ¨æ•°æ®åˆ†æé¢†åŸŸéå¸¸æµè¡Œï¼Œæœ‰pandasã€numpyç­‰å¼ºå¤§çš„åº“ã€‚")
            .hash("hash1")
            .filePath("/path/to/doc1")
            .build();
        
        Document doc2 = Document.builder()
            .id("2")
            .title("æœºå™¨å­¦ä¹ å®æˆ˜")
            .content("æœ¬ä¹¦ä»‹ç»æœºå™¨å­¦ä¹ ç®—æ³•åŠå…¶Pythonå®ç°ã€‚")
            .hash("hash2")
            .filePath("/path/to/doc2")
            .build();
        
        // 3. ç´¢å¼•æ–‡æ¡£
        indexEngine.indexDocument(doc1);
        indexEngine.indexDocument(doc2);
        indexEngine.commit();
        
        // 4. æœç´¢æ–‡æ¡£
        SearchResult result = indexEngine.search("Python", 10);
        
        System.out.println("æœç´¢ç»“æœ:");
        System.out.println("æ€»åŒ¹é…æ•°: " + result.getTotalHits());
        System.out.println("æŸ¥è¯¢è€—æ—¶: " + result.getQueryTimeMs() + "ms");
        
        for (SearchResult.ScoredDocument scored : result.getDocuments()) {
            Document doc = scored.getDocument();
            System.out.printf("- %s (å¾—åˆ†: %.2f)%n", doc.getTitle(), scored.getScore());
        }
        
        // 5. å…³é—­å¼•æ“
        indexEngine.close();
    }
}
```

### ç¤ºä¾‹3ï¼šæ–‡æ¡£è§£æ

```java
import com.framework.parser.DocumentParser;
import com.framework.parser.ParserRegistry;
import com.framework.parser.impl.*;

import java.io.File;

public class BasicParserExample {
    public static void main(String[] args) throws Exception {
        // 1. åˆå§‹åŒ–è§£æå™¨æ³¨å†Œè¡¨
        ParserRegistry registry = new ParserRegistry();
        
        // 2. æ³¨å†Œè§£æå™¨
        registry.registerParser(new TextParser());
        registry.registerParser(new TikaParser());
        registry.registerParser(new CodeParser());
        
        // 3. è§£ææ–‡ä»¶
        File file = new File("document.pdf");
        String content = registry.parseFile(file);
        
        System.out.println("è§£æå†…å®¹é•¿åº¦: " + content.length());
        System.out.println("å‰100å­—ç¬¦: " + content.substring(0, Math.min(100, content.length())));
        
        // 4. æŸ¥çœ‹æ”¯æŒçš„æ ¼å¼
        System.out.println("æ”¯æŒçš„æ ¼å¼: " + registry.getSupportedExtensions());
    }
}
```

### ç¤ºä¾‹4ï¼šå®Œæ•´æµç¨‹

```java
import com.framework.core.model.Document;
import com.framework.core.storage.StorageEngine;
import com.framework.core.storage.impl.*;
import com.framework.core.index.IndexEngine;
import com.framework.core.index.impl.LuceneIndexEngine;
import com.framework.parser.ParserRegistry;
import com.framework.parser.impl.*;

import java.io.File;
import java.io.IOException;

public class CompleteWorkflowExample {
    public static void main(String[] args) throws Exception {
        // 1. åˆå§‹åŒ–æ‰€æœ‰ç»„ä»¶
        DocumentHasher hasher = new SHA256DocumentHasher();
        MetadataManager metadataManager = new SQLiteMetadataManager("./data/metadata.db");
        StorageEngine storage = new FileSystemStorageEngine("./data", hasher, metadataManager);
        IndexEngine indexEngine = new LuceneIndexEngine("./data/index");
        
        ParserRegistry parser = new ParserRegistry();
        parser.registerParser(new TextParser());
        parser.registerParser(new TikaParser());
        parser.registerParser(new CodeParser());
        
        // 2. å¤„ç†æ–‡æ¡£ç›®å½•
        File docDir = new File("./documents");
        File[] files = docDir.listFiles();
        
        if (files != null) {
            for (File file : files) {
                try {
                    // è§£ææ–‡ä»¶
                    String content = parser.parseFile(file);
                    
                    // åˆ›å»ºæ–‡æ¡£å¯¹è±¡
                    Document doc = Document.builder()
                        .title(file.getName())
                        .content(content)
                        .addMetadata("originalPath", file.getAbsolutePath())
                        .addMetadata("fileSize", file.length())
                        .build();
                    
                    // å­˜å‚¨æ–‡æ¡£
                    String docId = storage.store(doc);
                    
                    // è®¾ç½®IDåç´¢å¼•
                    doc.setId(docId);
                    indexEngine.indexDocument(doc);
                    
                    System.out.println("å¤„ç†å®Œæˆ: " + file.getName());
                    
                } catch (Exception e) {
                    System.err.println("å¤„ç†å¤±è´¥: " + file.getName() + " - " + e.getMessage());
                }
            }
        }
        
        // 3. æäº¤ç´¢å¼•
        indexEngine.commit();
        
        // 4. æœç´¢æµ‹è¯•
        var result = indexEngine.search("Java", 5);
        System.out.println("\næœç´¢ç»“æœ ('Java'):");
        result.getDocuments().forEach(scored -> 
            System.out.println("- " + scored.getDocument().getTitle())
        );
        
        // 5. æ¸…ç†
        indexEngine.close();
        
        System.out.println("\nç»Ÿè®¡ä¿¡æ¯:");
        System.out.println("æ€»æ–‡æ¡£æ•°: " + storage.count());
    }
}
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### å­˜å‚¨é…ç½®

```java
// è‡ªå®šä¹‰å­˜å‚¨è·¯å¾„
StorageEngine storage = new FileSystemStorageEngine(
    "./custom/data/path",  // åŸºç¡€è·¯å¾„
    hasher,
    metadataManager
);
```

### ç´¢å¼•é…ç½®

```java
// Luceneç´¢å¼•é…ç½®åœ¨æ„é€ å‡½æ•°ä¸­
IndexEngine indexEngine = new LuceneIndexEngine("./custom/index/path");

// å¯ä»¥é€šè¿‡ä¿®æ”¹LuceneIndexEngineæºç è°ƒæ•´ä»¥ä¸‹å‚æ•°:
// - RAMBufferSizeMB: é»˜è®¤256MB
// - åˆ†æå™¨: é»˜è®¤StandardAnalyzer
// - åˆå¹¶ç­–ç•¥: é»˜è®¤TieredMergePolicy
```

### æ—¥å¿—é…ç½®

ç¼–è¾‘ `src/main/resources/logback.xml`:

```xml
<configuration>
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- è°ƒæ•´æ—¥å¿—çº§åˆ« -->
    <logger name="com.framework" level="DEBUG"/>
    
    <root level="INFO">
        <appender-ref ref="CONSOLE"/>
    </root>
</configuration>
```

---

## ğŸ“š é«˜çº§ç”¨æ³•

### æ‰¹é‡ç´¢å¼•ä¼˜åŒ–

```java
List<Document> documents = new ArrayList<>();

// æ”¶é›†æ–‡æ¡£
for (File file : files) {
    Document doc = createDocument(file);
    documents.add(doc);
}

// æ‰¹é‡ç´¢å¼•
indexEngine.indexBatch(documents);
```

### è‡ªå®šä¹‰è§£æå™¨

```java
public class CustomParser implements DocumentParser {
    
    @Override
    public String parse(File file) throws Exception {
        // è‡ªå®šä¹‰è§£æé€»è¾‘
        return customParseLogic(file);
    }
    
    @Override
    public String parse(InputStream inputStream, String fileName) throws Exception {
        return customParseLogic(inputStream);
    }
    
    @Override
    public boolean supports(String fileName) {
        return fileName.endsWith(".custom");
    }
    
    @Override
    public String[] getSupportedExtensions() {
        return new String[]{".custom"};
    }
}

// æ³¨å†Œè‡ªå®šä¹‰è§£æå™¨
registry.registerParser(new CustomParser());
```

### é«˜çº§æœç´¢

```java
// å¤šå­—æ®µæœç´¢
SearchResult result = indexEngine.advancedSearch(
    "æœºå™¨å­¦ä¹ ",
    new String[]{"title", "content", "metadata"},
    20  // è¿”å›å‰20ä¸ªç»“æœ
);

// éå†ç»“æœ
for (SearchResult.ScoredDocument scored : result.getDocuments()) {
    Document doc = scored.getDocument();
    float score = scored.getScore();
    
    System.out.printf("æ ‡é¢˜: %s%n", doc.getTitle());
    System.out.printf("å¾—åˆ†: %.4f%n", score);
    System.out.printf("è·¯å¾„: %s%n", doc.getFilePath());
    System.out.println("---");
}
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ‰¾ä¸åˆ°SQLiteæ•°æ®åº“æ–‡ä»¶

**ç­”**: ç¡®ä¿æŒ‡å®šçš„è·¯å¾„å­˜åœ¨ï¼Œæˆ–è€…è®©ç¨‹åºè‡ªåŠ¨åˆ›å»ºï¼š

```java
Path dbPath = Paths.get("./data/metadata.db");
Files.createDirectories(dbPath.getParent());
MetadataManager manager = new SQLiteMetadataManager(dbPath.toString());
```

### Q2: Luceneç´¢å¼•æŸå

**ç­”**: åˆ é™¤ç´¢å¼•ç›®å½•é‡æ–°æ„å»ºï¼š

```bash
rm -rf ./data/index
```

ç„¶åé‡æ–°è¿è¡Œç´¢å¼•ç¨‹åºã€‚

### Q3: å†…å­˜ä¸è¶³é”™è¯¯

**ç­”**: å¢åŠ JVMå †å†…å­˜ï¼š

```bash
java -Xmx2g -Xms1g -jar your-app.jar
```

### Q4: æ–‡æ¡£è§£æå¤±è´¥

**ç­”**: æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ”¯æŒï¼ŒæŸ¥çœ‹æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚æ”¯æŒçš„æ ¼å¼åˆ—è¡¨ï¼š

- æ–‡æœ¬: txt, md, log, csv, json, xml, html
- Office: pdf, doc, docx, xls, xlsx, ppt, pptx
- ä»£ç : java, py, js, ts, cpp, c, h, go, rs

---

## ğŸ“Š æ€§èƒ½å»ºè®®

### ç´¢å¼•æ€§èƒ½ä¼˜åŒ–

```java
// 1. å¢åŠ RAMç¼“å†²åŒº
// åœ¨LuceneIndexEngineä¸­ä¿®æ”¹:
config.setRAMBufferSizeMB(512.0);  // é»˜è®¤256MB

// 2. ä½¿ç”¨æ‰¹é‡ç´¢å¼•
indexEngine.indexBatch(documents);

// 3. å®šæœŸä¼˜åŒ–ç´¢å¼•
indexEngine.optimize();  // åœ¨æ‰¹é‡æ“ä½œåæ‰§è¡Œ
```

### æœç´¢æ€§èƒ½ä¼˜åŒ–

```java
// 1. é™åˆ¶è¿”å›ç»“æœæ•°é‡
SearchResult result = indexEngine.search("query", 10);

// 2. å®šæœŸé‡æ–°æ‰“å¼€ç´¢å¼•è¯»å–å™¨
indexEngine.commit();  // åˆ·æ–°ç´¢å¼•

// 3. ä½¿ç”¨å…·ä½“å­—æ®µæœç´¢
indexEngine.advancedSearch("query", new String[]{"title"}, 10);
```

### å­˜å‚¨æ€§èƒ½ä¼˜åŒ–

```java
// 1. ä½¿ç”¨SSDå­˜å‚¨
// 2. æ‰¹é‡å­˜å‚¨æ–‡æ¡£
// 3. å¯ç”¨å»é‡ï¼ˆé»˜è®¤å·²å¯ç”¨ï¼‰
```

---

## ğŸ”— ç›¸å…³èµ„æº

- [æ¶æ„è®¾è®¡æ–‡æ¡£](./20251121140000-æœ¬åœ°æ–‡ä»¶å­˜å‚¨RAGæ›¿ä»£æ¡†æ¶æ¶æ„è®¾è®¡.md)
- [ç¬¬ä¸€é˜¶æ®µå®æ–½æ–‡æ¡£](./20251121150000-ç¬¬ä¸€é˜¶æ®µå®æ–½-å­˜å‚¨å±‚å®ç°.md)
- [ç¬¬äºŒé˜¶æ®µå®æ–½æ–‡æ¡£](./20251121223000-ç¬¬äºŒé˜¶æ®µå®æ–½-ç´¢å¼•å¼•æ“å®ç°.md)
- [å®æ–½è¿›åº¦æ€»è§ˆ](./20251121-å®æ–½è¿›åº¦æ€»è§ˆ.md)

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ `logs/application.log`
2. æŸ¥é˜…ç›¸å…³æ–‡æ¡£
3. æäº¤Issueåˆ°é¡¹ç›®ä»“åº“
4. è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ

---

**æœ€åæ›´æ–°**: 2025-11-21  
**ä¸‹æ¬¡æ›´æ–°**: ç¬¬ä¸‰é˜¶æ®µåŠŸèƒ½å‘å¸ƒå

