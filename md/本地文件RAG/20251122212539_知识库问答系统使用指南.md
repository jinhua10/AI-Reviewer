# çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ“– ç³»ç»Ÿç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªåŸºäº Spring Boot çš„çŸ¥è¯†åº“æ™ºèƒ½é—®ç­”ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼çš„æ–‡æ¡£æ£€ç´¢å’Œé—®ç­”ã€‚

### âœ¨ ä¸»è¦ç‰¹æ€§

- **å¤šæ ¼å¼æ”¯æŒ**: Excel, Word, PowerPoint, PDF, TXT, Markdownç­‰
- **è¯­ä¹‰æ£€ç´¢**: ä½¿ç”¨å‘é‡åµŒå…¥æ¨¡å‹è¿›è¡Œæ™ºèƒ½è¯­ä¹‰æ£€ç´¢
- **çµæ´»é…ç½®**: é€šè¿‡ application.yml é…ç½®æ‰€æœ‰å‚æ•°
- **REST API**: æä¾›æ ‡å‡†çš„ HTTP æ¥å£
- **è‡ªåŠ¨æ£€æŸ¥**: å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥æ¨¡å‹æ–‡ä»¶

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å‡†å¤‡æ¨¡å‹æ–‡ä»¶

ç³»ç»Ÿå¯åŠ¨å‰éœ€è¦ä¸‹è½½å‘é‡åµŒå…¥æ¨¡å‹æ–‡ä»¶ã€‚

#### æ¨èæ¨¡å‹ï¼ˆæŒ‰æ€§èƒ½æ’åºï¼‰

1. **BGE-M3** â­â­â­â­â­ (2024æœ€æ–°ï¼Œæ€§èƒ½æœ€ä½³)
   ```bash
   https://huggingface.co/BAAI/bge-m3
   æ”¾åˆ°: src/main/resources/models/bge-m3/model.onnx
   ```

2. **Multilingual-E5-Large** â­â­â­â­ (å¾®è½¯å‡ºå“ï¼Œå¹³è¡¡)
   ```bash
   https://huggingface.co/intfloat/multilingual-e5-large
   æ”¾åˆ°: src/main/resources/models/multilingual-e5-large/model.onnx
   ```

3. **Paraphrase-Multilingual** â­â­â­ (è½»é‡ï¼Œå…¼å®¹)
   ```bash
   https://huggingface.co/sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2
   æ”¾åˆ°: src/main/resources/models/paraphrase-multilingual/model.onnx
   ```

#### Python ä¸‹è½½è„šæœ¬

```python
pip install optimum[onnxruntime] transformers

from optimum.onnxruntime import ORTModelForFeatureExtraction
from transformers import AutoTokenizer

# ä¸‹è½½ BGE-M3ï¼ˆæ¨èï¼‰
model = ORTModelForFeatureExtraction.from_pretrained('BAAI/bge-m3', export=True)
tokenizer = AutoTokenizer.from_pretrained('BAAI/bge-m3')

model.save_pretrained('src/main/resources/models/bge-m3')
tokenizer.save_pretrained('src/main/resources/models/bge-m3')
```

### 2. å‡†å¤‡æ–‡æ¡£

å°†çŸ¥è¯†åº“æ–‡æ¡£æ”¾åˆ°æŒ‡å®šç›®å½•ï¼š

```bash
mkdir -p ./data/documents

# æ”¯æŒçš„æ ¼å¼
- Excel: .xlsx, .xls
- Word: .docx, .doc
- PowerPoint: .pptx, .ppt
- PDF: .pdf
- æ–‡æœ¬: .txt, .md
- å…¶ä»–: .html, .xml
```

### 3. é…ç½®ç³»ç»Ÿ

ç¼–è¾‘ `src/main/resources/application.yml`ï¼š

```yaml
knowledge:
  qa:
    knowledge-base:
      storage-path: ./data/knowledge-base
      source-path: ./data/documents  # ä¿®æ”¹ä¸ºä½ çš„æ–‡æ¡£è·¯å¾„
      rebuild-on-startup: true       # é¦–æ¬¡å¯åŠ¨è®¾ä¸º true
    
    vector-search:
      enabled: true                  # å¯ç”¨å‘é‡æ£€ç´¢
```

### 4. å¯åŠ¨åº”ç”¨

```bash
# Maven
mvn spring-boot:run

# Gradle
gradle bootRun

# JAR
java -jar knowledge-qa-system.jar
```

### 5. ä½¿ç”¨ API

#### é—®ç­”æ¥å£

```bash
curl -X POST http://localhost:8080/api/qa/ask \
  -H "Content-Type: application/json" \
  -d '{"question": "è’™å¤æ—å©šé…æƒ…å†µ"}'
```

å“åº”ï¼š
```json
{
  "question": "è’™å¤æ—å©šé…æƒ…å†µ",
  "answer": "æ ¹æ®æ£€ç´¢åˆ°çš„æ•°æ®...",
  "sources": ["file1.xlsx", "file2.docx"],
  "responseTimeMs": 1234
}
```

#### æœç´¢æ–‡æ¡£

```bash
curl "http://localhost:8080/api/qa/search?query=äººå£&limit=10"
```

#### è·å–ç»Ÿè®¡

```bash
curl http://localhost:8080/api/qa/statistics
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### çŸ¥è¯†åº“é…ç½®

```yaml
knowledge:
  qa:
    knowledge-base:
      # çŸ¥è¯†åº“å­˜å‚¨è·¯å¾„
      storage-path: ./data/knowledge-base
      
      # æ–‡æ¡£æºè·¯å¾„ï¼ˆæ–‡ä»¶å¤¹æˆ–å•ä¸ªæ–‡ä»¶ï¼‰
      source-path: ./data/documents
      
      # æ˜¯å¦åœ¨å¯åŠ¨æ—¶é‡å»ºçŸ¥è¯†åº“
      # true: æ¯æ¬¡å¯åŠ¨é‡å»ºï¼ˆå¼€å‘æ¨¡å¼ï¼‰
      # false: ä½¿ç”¨å·²æœ‰çŸ¥è¯†åº“ï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰
      rebuild-on-startup: false
```

### å‘é‡æ£€ç´¢é…ç½®

```yaml
knowledge:
  qa:
    vector-search:
      # æ˜¯å¦å¯ç”¨å‘é‡æ£€ç´¢
      enabled: true
      
      # æ¨¡å‹é…ç½®
      model:
        # æ¨¡å‹æœç´¢è·¯å¾„ï¼ˆç³»ç»Ÿä¼šæŒ‰é¡ºåºæŸ¥æ‰¾ï¼‰
        search-paths:
          - bge-m3                    # ä¼˜å…ˆä½¿ç”¨ BGE-M3
          - multilingual-e5-large
          - paraphrase-multilingual
      
      # æ£€ç´¢é…ç½®
      similarity-threshold: 0.4       # ç›¸ä¼¼åº¦é˜ˆå€¼
      top-k: 20                       # è¿”å›æ–‡æ¡£æ•°
```

### æ–‡æ¡£å¤„ç†é…ç½®

```yaml
knowledge:
  qa:
    document:
      # æ”¯æŒçš„æ–‡ä»¶æ ¼å¼
      supported-formats:
        - xlsx
        - xls
        - docx
        - pptx
        - pdf
        - txt
      
      # å¤§å°é™åˆ¶
      max-file-size-mb: 200           # æœ€å¤§æ–‡ä»¶å¤§å°
      max-content-size-mb: 50         # æœ€å¤§å†…å®¹å¤§å°
      
      # åˆ†å—é…ç½®
      chunk-size: 2000                # åˆ†å—å¤§å°ï¼ˆå­—ç¬¦ï¼‰
      chunk-overlap: 400              # é‡å å¤§å°ï¼ˆå­—ç¬¦ï¼‰
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: ä¼ä¸šæ–‡æ¡£é—®ç­”

**æ–‡æ¡£ç±»å‹**: åˆåŒã€æŠ¥å‘Šã€æ‰‹å†Œ

**é…ç½®**:
```yaml
knowledge:
  qa:
    knowledge-base:
      source-path: /company/documents
    vector-search:
      model:
        search-paths:
          - bge-m3  # ä½¿ç”¨æœ€ä½³æ¨¡å‹
```

### åœºæ™¯ 2: å­¦æœ¯è®ºæ–‡æ£€ç´¢

**æ–‡æ¡£ç±»å‹**: PDF è®ºæ–‡ã€Word æ–‡æ¡£

**é…ç½®**:
```yaml
knowledge:
  qa:
    document:
      supported-formats:
        - pdf
        - docx
      chunk-size: 3000  # æ›´å¤§çš„åˆ†å—
```

### åœºæ™¯ 3: Excel æ•°æ®åˆ†æ

**æ–‡æ¡£ç±»å‹**: Excel æŠ¥è¡¨

**é…ç½®**:
```yaml
knowledge:
  qa:
    document:
      supported-formats:
        - xlsx
        - xls
      max-content-size-mb: 100  # æ”¯æŒæ›´å¤§æ–‡ä»¶
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨

**é”™è¯¯ä¿¡æ¯**:
```
âŒ æœªæ‰¾åˆ°å‘é‡åµŒå…¥æ¨¡å‹æ–‡ä»¶ï¼
```

**è§£å†³æ–¹æ³•**:
1. ä¸‹è½½æ¨¡å‹æ–‡ä»¶ï¼ˆå‚è€ƒä¸Šè¿°è¯´æ˜ï¼‰
2. æ”¾åˆ° `src/main/resources/models/` ç›®å½•
3. æˆ–è€…ç¦ç”¨å‘é‡æ£€ç´¢ï¼š
   ```yaml
   knowledge:
     qa:
       vector-search:
         enabled: false
   ```

### é—®é¢˜ 2: çŸ¥è¯†åº“æ„å»ºå¤±è´¥

**å¯èƒ½åŸå› **:
- æ–‡æ¡£è·¯å¾„ä¸å­˜åœ¨
- æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ
- æ–‡ä»¶æŸå

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥ `source-path` é…ç½®
2. ç¡®è®¤æ–‡ä»¶æ ¼å¼åœ¨ `supported-formats` ä¸­
3. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

### é—®é¢˜ 3: æ£€ç´¢ç»“æœä¸å‡†ç¡®

**ä¼˜åŒ–æ–¹æ³•**:
1. ä½¿ç”¨æ›´å¥½çš„æ¨¡å‹ï¼ˆBGE-M3ï¼‰
2. è°ƒæ•´ç›¸ä¼¼åº¦é˜ˆå€¼ï¼š
   ```yaml
   similarity-threshold: 0.3  # é™ä½é˜ˆå€¼ï¼Œè¿”å›æ›´å¤šç»“æœ
   ```
3. å¢åŠ è¿”å›æ–‡æ¡£æ•°ï¼š
   ```yaml
   top-k: 30  # å¢åŠ è¿”å›æ•°é‡
   ```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### å†…å­˜ä¼˜åŒ–

```yaml
# JVM å‚æ•°
java -Xmx4g -Xms2g -jar knowledge-qa-system.jar
```

### æ¨¡å‹é€‰æ‹©

| æ¨¡å‹ | å†…å­˜å ç”¨ | é€Ÿåº¦ | å‡†ç¡®ç‡ | æ¨èåœºæ™¯ |
|------|---------|------|--------|---------|
| BGE-M3 | 2.5GB | ä¸­ | æœ€é«˜ | ç”Ÿäº§ç¯å¢ƒï¼Œè¿½æ±‚å‡†ç¡®ç‡ |
| E5-Large | 1.5GB | ä¸­ | é«˜ | å¹³è¡¡æ€§èƒ½å’Œå‡†ç¡®ç‡ |
| Paraphrase | 300MB | å¿« | ä¸­ | å¼€å‘æµ‹è¯•ï¼Œèµ„æºå—é™ |

### åˆ†å—ç­–ç•¥

```yaml
# å°æ–‡æ¡£ï¼ˆ< 1MBï¼‰
chunk-size: 1000
chunk-overlap: 200

# å¤§æ–‡æ¡£ï¼ˆ> 10MBï¼‰
chunk-size: 3000
chunk-overlap: 600
```

---

## ğŸŒ API æ¥å£æ–‡æ¡£

### POST /api/qa/ask

**åŠŸèƒ½**: é—®ç­”æ¥å£

**è¯·æ±‚**:
```json
{
  "question": "ä½ çš„é—®é¢˜"
}
```

**å“åº”**:
```json
{
  "question": "ä½ çš„é—®é¢˜",
  "answer": "AIç”Ÿæˆçš„å›ç­”",
  "sources": ["source1.xlsx", "source2.docx"],
  "responseTimeMs": 1234
}
```

### GET /api/qa/search

**åŠŸèƒ½**: æœç´¢æ–‡æ¡£

**å‚æ•°**:
- `query`: æœç´¢å…³é”®è¯
- `limit`: è¿”å›æ•°é‡ï¼ˆé»˜è®¤10ï¼‰

**å“åº”**:
```json
{
  "query": "å…³é”®è¯",
  "total": 5,
  "documents": [
    {
      "id": "doc-id",
      "title": "æ–‡æ¡£æ ‡é¢˜",
      "content": "æ–‡æ¡£å†…å®¹",
      "excerpt": "æ‘˜è¦..."
    }
  ]
}
```

### GET /api/qa/statistics

**åŠŸèƒ½**: è·å–ç»Ÿè®¡ä¿¡æ¯

**å“åº”**:
```json
{
  "documentCount": 1000,
  "indexedDocumentCount": 950
}
```

### GET /api/qa/health

**åŠŸèƒ½**: å¥åº·æ£€æŸ¥

**å“åº”**:
```json
{
  "status": "UP",
  "message": "çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿè¿è¡Œæ­£å¸¸"
}
```

---

## ğŸ“š è¿›é˜¶é…ç½®

### ä½¿ç”¨ç¯å¢ƒå˜é‡

```bash
# è®¾ç½® API Key
export AI_API_KEY=your-deepseek-api-key

# è¦†ç›–é…ç½®
export KNOWLEDGE_QA_KNOWLEDGE_BASE_SOURCE_PATH=/custom/path

# å¯åŠ¨åº”ç”¨
java -jar knowledge-qa-system.jar
```

### ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶

```bash
# å¼€å‘ç¯å¢ƒ
java -jar knowledge-qa-system.jar --spring.profiles.active=dev

# ç”Ÿäº§ç¯å¢ƒ
java -jar knowledge-qa-system.jar --spring.profiles.active=prod

# è‡ªå®šä¹‰é…ç½®
java -jar knowledge-qa-system.jar --spring.config.location=file:./custom-config.yml
```

### å¤šçŸ¥è¯†åº“æ”¯æŒ

å¦‚éœ€æ”¯æŒå¤šä¸ªç‹¬ç«‹çš„çŸ¥è¯†åº“ï¼Œå¯ä»¥éƒ¨ç½²å¤šä¸ªå®ä¾‹ï¼š

```bash
# å®ä¾‹ 1 - æŠ€æœ¯æ–‡æ¡£
java -jar knowledge-qa-system.jar \
  --server.port=8081 \
  --knowledge.qa.knowledge-base.source-path=/docs/tech \
  --knowledge.qa.knowledge-base.storage-path=/data/kb-tech

# å®ä¾‹ 2 - ä¸šåŠ¡æ–‡æ¡£
java -jar knowledge-qa-system.jar \
  --server.port=8082 \
  --knowledge.qa.knowledge-base.source-path=/docs/business \
  --knowledge.qa.knowledge-base.storage-path=/data/kb-business
```

---

## ğŸ‰ æ€»ç»“

æ­å–œï¼ä½ å·²ç»æˆåŠŸæ­å»ºäº†çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿã€‚

### å…³é”®ç‚¹

âœ… **æ¨¡å‹æ–‡ä»¶**: å¿…é¡»å…ˆä¸‹è½½åˆ° `resources/models/` ç›®å½•  
âœ… **æ–‡æ¡£å‡†å¤‡**: æ”¾åˆ°é…ç½®çš„ `source-path` ç›®å½•  
âœ… **é¦–æ¬¡å¯åŠ¨**: è®¾ç½® `rebuild-on-startup: true`  
âœ… **ç”Ÿäº§éƒ¨ç½²**: è®¾ç½® `rebuild-on-startup: false`

### ä¸‹ä¸€æ­¥

- è°ƒæ•´é…ç½®ä¼˜åŒ–æ€§èƒ½
- é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ
- æ·»åŠ ç”¨æˆ·ç•Œé¢
- æ‰©å±•æ›´å¤šåŠŸèƒ½

éœ€è¦å¸®åŠ©ï¼ŸæŸ¥çœ‹è¯¦ç»†æ–‡æ¡£æˆ–æäº¤ Issueã€‚

